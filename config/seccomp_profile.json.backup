{
  "comment": "Docker Sandbox Seccomp Security Profile for FinLab",
  "description": "Restrictive seccomp profile for isolated strategy execution. Blocks process creation, networking, and privileged operations while allowing file I/O and Python runtime syscalls.",
  "defaultAction": "SCMP_ACT_ERRNO",
  "architectures": [
    "SCMP_ARCH_X86_64",
    "SCMP_ARCH_X86",
    "SCMP_ARCH_X32",
    "SCMP_ARCH_AARCH64",
    "SCMP_ARCH_ARM"
  ],
  "syscalls": [
    {
      "comment": "File I/O Operations - Essential for reading data and writing results",
      "names": [
        "read",
        "readv",
        "pread64",
        "preadv",
        "preadv2",
        "write",
        "writev",
        "pwrite64",
        "pwritev",
        "pwritev2",
        "open",
        "openat",
        "openat2",
        "close",
        "close_range",
        "lseek",
        "llseek",
        "_llseek"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "File Metadata Operations - Required for stat, directory listing, file checks",
      "names": [
        "stat",
        "fstat",
        "lstat",
        "fstatat",
        "statx",
        "newfstatat",
        "stat64",
        "fstat64",
        "lstat64",
        "getdents",
        "getdents64",
        "readlink",
        "readlinkat",
        "access",
        "faccessat",
        "faccessat2"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Memory Management - Required for Python runtime, numpy, pandas",
      "names": [
        "mmap",
        "mmap2",
        "munmap",
        "mremap",
        "mprotect",
        "madvise",
        "brk",
        "sbrk",
        "mlock",
        "munlock",
        "mlock2",
        "mlockall",
        "munlockall"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Process Information - Safe read-only process queries",
      "names": [
        "getpid",
        "getppid",
        "gettid",
        "getuid",
        "getgid",
        "geteuid",
        "getegid",
        "getresuid",
        "getresgid",
        "getgroups",
        "getpgrp",
        "getpgid",
        "getsid"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Time Operations - Required for timestamps, performance measurement",
      "names": [
        "clock_gettime",
        "clock_getres",
        "gettimeofday",
        "time",
        "nanosleep",
        "clock_nanosleep"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Signal Handling - Required for Python signal handlers, graceful shutdown",
      "names": [
        "rt_sigaction",
        "rt_sigprocmask",
        "rt_sigreturn",
        "sigaltstack",
        "rt_sigsuspend",
        "rt_sigpending",
        "rt_sigtimedwait",
        "rt_sigqueueinfo"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Thread Operations - Required for Python threading, multiprocessing (limited)",
      "names": [
        "futex",
        "get_robust_list",
        "set_robust_list",
        "set_tid_address"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "File Descriptor Operations - Essential for I/O multiplexing",
      "names": [
        "select",
        "pselect6",
        "poll",
        "ppoll",
        "epoll_create",
        "epoll_create1",
        "epoll_ctl",
        "epoll_wait",
        "epoll_pwait",
        "epoll_pwait2",
        "dup",
        "dup2",
        "dup3",
        "fcntl",
        "fcntl64",
        "ioctl"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Directory Operations - Required for file management in /tmp",
      "names": [
        "mkdir",
        "mkdirat",
        "rmdir",
        "unlink",
        "unlinkat",
        "rename",
        "renameat",
        "renameat2",
        "chdir",
        "fchdir",
        "getcwd"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "File Permissions - Required for chmod/chown in /tmp (limited)",
      "names": [
        "chmod",
        "fchmod",
        "fchmodat",
        "chown",
        "fchown",
        "lchown",
        "fchownat",
        "umask"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Pipe Operations - Required for subprocess communication (limited)",
      "names": [
        "pipe",
        "pipe2"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Resource Limits - Safe read operations for system limits",
      "names": [
        "getrlimit",
        "ugetrlimit",
        "prlimit64",
        "getrusage"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "System Information - Safe read-only system queries",
      "names": [
        "uname",
        "sysinfo",
        "getrandom",
        "getentropy"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Exit Operations - Required for clean process termination",
      "names": [
        "exit",
        "exit_group"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Advanced File Operations - For efficient file I/O",
      "names": [
        "sendfile",
        "sendfile64",
        "copy_file_range",
        "splice",
        "tee",
        "vmsplice"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Asynchronous I/O - For high-performance file operations",
      "names": [
        "io_setup",
        "io_destroy",
        "io_getevents",
        "io_submit",
        "io_cancel",
        "io_pgetevents",
        "io_uring_setup",
        "io_uring_enter",
        "io_uring_register"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Wait Operations - Required for process synchronization",
      "names": [
        "wait4",
        "waitid",
        "waitpid"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Scheduling - Required for yield and scheduling hints",
      "names": [
        "sched_yield",
        "sched_getaffinity",
        "sched_getparam",
        "sched_getscheduler"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    },
    {
      "comment": "Architecture-specific - Required for 32-bit compatibility",
      "names": [
        "arch_prctl",
        "modify_ldt",
        "set_thread_area",
        "get_thread_area"
      ],
      "action": "SCMP_ACT_ALLOW",
      "args": []
    }
  ],
  "blockedSyscalls": {
    "comment": "BLOCKED SYSCALLS - These are explicitly denied for security",
    "categories": {
      "processCreation": {
        "description": "Process creation and execution - CRITICAL SECURITY RISK",
        "syscalls": [
          "fork",
          "vfork",
          "clone",
          "clone3",
          "execve",
          "execveat"
        ],
        "rationale": "Prevents container from spawning new processes or executing arbitrary binaries. Blocks code injection and privilege escalation attacks."
      },
      "networking": {
        "description": "Network operations - PREVENTS DATA EXFILTRATION",
        "syscalls": [
          "socket",
          "socketpair",
          "bind",
          "listen",
          "accept",
          "accept4",
          "connect",
          "sendto",
          "recvfrom",
          "sendmsg",
          "recvmsg",
          "sendmmsg",
          "recvmmsg",
          "shutdown",
          "getsockname",
          "getpeername",
          "socketcall",
          "setsockopt",
          "getsockopt"
        ],
        "rationale": "Blocks all network syscalls to prevent data exfiltration, unauthorized API calls, and remote code execution. Strategy should only work with local data."
      },
      "privilegedOperations": {
        "description": "Privileged system operations - PREVENTS CONTAINER BREAKOUT",
        "syscalls": [
          "mount",
          "umount",
          "umount2",
          "pivot_root",
          "chroot",
          "setuid",
          "setgid",
          "setreuid",
          "setregid",
          "setresuid",
          "setresgid",
          "setfsuid",
          "setfsgid",
          "setgroups",
          "capset",
          "acct",
          "reboot",
          "swapon",
          "swapoff",
          "sethostname",
          "setdomainname",
          "iopl",
          "ioperm"
        ],
        "rationale": "Prevents privilege escalation, container breakout, and system modification. These syscalls require CAP_SYS_ADMIN or other dangerous capabilities."
      },
      "kernelModules": {
        "description": "Kernel module operations - PREVENTS KERNEL COMPROMISE",
        "syscalls": [
          "init_module",
          "finit_module",
          "delete_module",
          "create_module",
          "query_module"
        ],
        "rationale": "Blocks kernel module loading/unloading to prevent kernel-level exploits and rootkits."
      },
      "namespaces": {
        "description": "Namespace manipulation - PREVENTS CONTAINER ESCAPE",
        "syscalls": [
          "unshare",
          "setns"
        ],
        "rationale": "Prevents namespace manipulation that could lead to container escape or privilege escalation."
      },
      "debugging": {
        "description": "Process debugging - PREVENTS REVERSE ENGINEERING",
        "syscalls": [
          "ptrace",
          "process_vm_readv",
          "process_vm_writev",
          "kcmp"
        ],
        "rationale": "Blocks debugging interfaces that could be used to inspect or modify other processes, including the container runtime."
      },
      "performance": {
        "description": "Performance monitoring - INFORMATION DISCLOSURE",
        "syscalls": [
          "perf_event_open"
        ],
        "rationale": "Prevents performance counter access that could leak timing information for side-channel attacks."
      },
      "timeModification": {
        "description": "System time modification - AUDIT LOG INTEGRITY",
        "syscalls": [
          "clock_settime",
          "settimeofday",
          "adjtimex",
          "clock_adjtime"
        ],
        "rationale": "Prevents time manipulation that could compromise audit logs or bypass time-based security checks."
      },
      "keyManagement": {
        "description": "Kernel keyring operations - CREDENTIAL THEFT",
        "syscalls": [
          "add_key",
          "request_key",
          "keyctl"
        ],
        "rationale": "Blocks access to kernel keyring to prevent credential theft and unauthorized access to secrets."
      },
      "ipc": {
        "description": "System V IPC - PREVENTS INTER-CONTAINER COMMUNICATION",
        "syscalls": [
          "msgget",
          "msgsnd",
          "msgrcv",
          "msgctl",
          "semget",
          "semop",
          "semctl",
          "semtimedop",
          "shmget",
          "shmat",
          "shmdt",
          "shmctl"
        ],
        "rationale": "Blocks System V IPC to prevent unauthorized communication between containers and host processes."
      },
      "quotas": {
        "description": "Quota management - RESOURCE MANIPULATION",
        "syscalls": [
          "quotactl"
        ],
        "rationale": "Prevents quota manipulation that could bypass resource limits."
      },
      "bpf": {
        "description": "BPF operations - KERNEL EXPLOIT VECTOR",
        "syscalls": [
          "bpf"
        ],
        "rationale": "Blocks BPF to prevent kernel-level monitoring and potential exploits through eBPF programs."
      },
      "kexec": {
        "description": "Kernel execution - ULTIMATE PRIVILEGE ESCALATION",
        "syscalls": [
          "kexec_load",
          "kexec_file_load"
        ],
        "rationale": "Prevents loading and executing a new kernel, the ultimate form of system compromise."
      },
      "userNamespaces": {
        "description": "User namespace operations - PRIVILEGE ESCALATION VECTOR",
        "syscalls": [
          "userfaultfd"
        ],
        "rationale": "Blocks userfaultfd to prevent known privilege escalation exploits."
      },
      "lookup": {
        "description": "Filesystem lookup operations - PREVENTS UNAUTHORIZED FILE ACCESS",
        "syscalls": [
          "name_to_handle_at",
          "open_by_handle_at"
        ],
        "rationale": "Blocks handle-based file access that could bypass path-based security checks."
      }
    }
  },
  "securityNotes": {
    "philosophy": "This profile implements a strict allowlist approach. Only syscalls necessary for Python execution and file I/O are allowed. All process creation, networking, and privileged operations are blocked.",
    "allowedOperations": [
      "File I/O: read, write, open, close, stat (required for data loading and result writing)",
      "Memory management: mmap, brk (required for Python runtime and libraries like numpy/pandas)",
      "Time operations: clock_gettime, nanosleep (required for timestamps and performance measurement)",
      "Directory operations: mkdir, rmdir (limited to /tmp via Docker mount restrictions)",
      "Process queries: getpid, getuid (safe read-only queries)"
    ],
    "blockedOperations": [
      "Process creation: fork, clone, execve (prevents spawning subprocesses)",
      "Networking: socket, connect, bind (prevents data exfiltration and remote code execution)",
      "Privileged ops: mount, setuid, capset (prevents privilege escalation)",
      "Kernel modules: init_module, delete_module (prevents kernel compromise)",
      "Debugging: ptrace, process_vm_readv (prevents process inspection)"
    ],
    "defenseInDepth": [
      "Layer 1: AST validation (SecurityValidator) - blocks dangerous Python code before execution",
      "Layer 2: Docker network isolation (network_mode: none) - no network stack available",
      "Layer 3: Docker filesystem isolation (read_only: true, tmpfs: /tmp) - only /tmp is writable",
      "Layer 4: Seccomp profile (this file) - kernel-level syscall filtering",
      "Layer 5: Resource limits (cgroup) - prevents resource exhaustion"
    ],
    "testing": "This profile must be tested with real Python strategies to ensure legitimate operations work while dangerous operations are blocked. Use 'docker run --security-opt seccomp=/path/to/seccomp_profile.json' to apply."
  }
}
