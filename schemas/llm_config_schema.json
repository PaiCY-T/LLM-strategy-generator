{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LLM Configuration Schema",
  "description": "Validation schema for LLM configuration section in learning_system.yaml",
  "type": "object",
  "properties": {
    "llm": {
      "type": "object",
      "description": "LLM-driven strategy innovation configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable/disable LLM innovation mode"
        },
        "provider": {
          "type": "string",
          "enum": ["openrouter", "gemini", "openai"],
          "description": "LLM provider selection"
        },
        "innovation_rate": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Percentage of iterations using LLM (0.0-1.0)"
        },
        "fallback": {
          "type": "object",
          "description": "Fallback behavior when LLM fails",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable automatic fallback to Factor Graph"
            },
            "max_retries": {
              "type": "integer",
              "minimum": 0,
              "description": "Max retry attempts before fallback"
            },
            "retry_delay": {
              "type": "number",
              "minimum": 0,
              "description": "Retry delay in seconds (exponential backoff)"
            }
          },
          "required": ["enabled", "max_retries", "retry_delay"]
        },
        "generation": {
          "type": "object",
          "description": "LLM generation settings",
          "properties": {
            "max_tokens": {
              "type": "integer",
              "minimum": 100,
              "maximum": 10000,
              "description": "Maximum tokens in LLM response"
            },
            "temperature": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 2.0,
              "description": "Sampling temperature for generation"
            },
            "timeout": {
              "type": "integer",
              "minimum": 10,
              "maximum": 600,
              "description": "Timeout for LLM API calls (seconds)"
            }
          },
          "required": ["max_tokens", "temperature", "timeout"]
        },
        "model": {
          "type": "string",
          "description": "Model name for the selected provider"
        },
        "openrouter": {
          "type": "object",
          "description": "OpenRouter provider configuration",
          "properties": {
            "api_key": {
              "type": "string",
              "description": "API key (environment variable)"
            },
            "model": {
              "type": "string",
              "description": "Model selection"
            },
            "http_referer": {
              "type": "string",
              "description": "HTTP referer for usage tracking"
            },
            "app_name": {
              "type": "string",
              "description": "Application name for usage tracking"
            }
          },
          "required": ["api_key"]
        },
        "gemini": {
          "type": "object",
          "description": "Google Gemini provider configuration",
          "properties": {
            "api_key": {
              "type": "string",
              "description": "API key (environment variable)"
            },
            "model": {
              "type": "string",
              "description": "Model selection"
            },
            "safety": {
              "type": "object",
              "properties": {
                "block_none": {
                  "type": "boolean"
                }
              }
            }
          },
          "required": ["api_key"]
        },
        "openai": {
          "type": "object",
          "description": "OpenAI provider configuration",
          "properties": {
            "api_key": {
              "type": "string",
              "description": "API key (environment variable)"
            },
            "model": {
              "type": "string",
              "description": "Model selection"
            },
            "organization": {
              "type": "string",
              "description": "Organization ID (optional)"
            }
          },
          "required": ["api_key"]
        }
      },
      "required": ["enabled", "provider", "innovation_rate", "fallback", "generation"]
    }
  },
  "required": ["llm"]
}
