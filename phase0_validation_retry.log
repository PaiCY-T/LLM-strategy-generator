Traceback (most recent call last):
  File "/mnt/c/Users/jnpi/Documents/finlab/src/templates/momentum_exit_template.py", line 405, in generate_strategy
    positions = self._apply_exit_strategies(positions, data_dict, params)
  File "/mnt/c/Users/jnpi/Documents/finlab/src/templates/momentum_exit_template.py", line 263, in _apply_exit_strategies
    atr = atr.reindex(columns=positions.columns)
TypeError: Series.reindex() got an unexpected keyword argument 'columns'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/c/Users/jnpi/Documents/finlab/run_phase0_exit_validation.py", line 371, in <module>
    analysis = main()
  File "/mnt/c/Users/jnpi/Documents/finlab/run_phase0_exit_validation.py", line 345, in main
    enhanced_report, enhanced_metrics = test_enhanced_momentum_with_exits(test_params)
  File "/mnt/c/Users/jnpi/Documents/finlab/run_phase0_exit_validation.py", line 108, in test_enhanced_momentum_with_exits
    report, metrics = momentum_exit_template.generate_strategy(enhanced_params)
  File "/mnt/c/Users/jnpi/Documents/finlab/src/templates/momentum_exit_template.py", line 460, in generate_strategy
    raise RuntimeError(
RuntimeError: Strategy generation failed for MomentumExitTemplate: Series.reindex() got an unexpected keyword argument 'columns'
================================================================================
PHASE 0: EXIT STRATEGY HYPOTHESIS VALIDATION
================================================================================

Task 0.2: Backtest Comparison (Baseline vs. Enhanced)
Test Date: 2025-10-20 14:45:48

Test Configuration:
  Momentum Period:     20 days
  MA Period:           60 days
  Catalyst Type:       revenue
  Catalyst Lookback:   3 months
  Portfolio Size:      10 stocks
  Rebalancing:         M (Monthly)

================================================================================
BASELINE: Momentum Template (No Exit Strategies)
================================================================================

Parameters: {'momentum_period': 20, 'ma_periods': 60, 'catalyst_type': 'revenue', 'catalyst_lookback': 3, 'n_stocks': 10, 'stop_loss': 0.1, 'resample': 'M', 'resample_offset': 0}

Running backtest...

✅ Backtest completed in 11.8s

Baseline Metrics:
  Sharpe Ratio:   -0.1215
  Annual Return:  -4.22%
  Max Drawdown:   -72.25%

================================================================================
ENHANCED: Momentum + Exit Strategies
================================================================================

Parameters: {'momentum_period': 20, 'ma_periods': 60, 'catalyst_type': 'revenue', 'catalyst_lookback': 3, 'n_stocks': 10, 'stop_loss': 0.1, 'resample': 'M', 'resample_offset': 0, 'use_exits': True, 'atr_period': 14, 'stop_atr_mult': 2.0, 'profit_atr_mult': 3.0, 'max_hold_days': 30}

Exit Strategies:
  1. ATR Trailing Stop-Loss: 2.0× ATR
  2. Fixed Profit Target:    3.0× ATR
  3. Time-Based Exit:        30 days max
  4. ATR Period:             14 days

Running backtest...

❌ Validation test failed: Strategy generation failed for MomentumExitTemplate: Series.reindex() got an unexpected keyword argument 'columns'
