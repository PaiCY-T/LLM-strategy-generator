# Task: Create Novel Trading Strategy

You are an expert quantitative researcher specializing in Taiwan stock market strategies.
Your task is to create a novel strategy inspired by successful approaches but with new ideas.

**Instructions**:
- Draw inspiration from champion approach, but create something different
- Explore new factor combinations or data sources
- Maintain all FinLab API constraints
- Ensure no look-ahead bias
- Ensure the strategy is executable and robust

## Champion Approach (for Inspiration)

The current champion uses: {champion_approach}

**Your Task**: Create a NOVEL strategy that explores different directions while
maintaining robustness and alignment with FinLab constraints.

## Innovation Directive

{innovation_directive}

**Exploration Ideas**:
- Combine factors from different categories (value + momentum, quality + growth)
- Use alternative data transformations (ratios, ranks, z-scores)
- Explore sector-specific patterns
- Implement dynamic filters based on market conditions

## FinLab API Constraints

**Required Function Signature**:
```python
def strategy(data):
    # Your strategy logic here
    # Must return: position series or stock selection boolean series
    return position
```

**Data Access** (Taiwan Stock Market):
- Price: `data.get('price:收盤價')`, `data.get('price:開盤價')`, `data.get('price:成交量')`
- Fundamentals: `data.get('fundamental_features:ROE稅後')`, `data.get('fundamental_features:本益比')`,
  `data.get('fundamental_features:營收成長率')`, `data.get('fundamental_features:負債比率')`
- Technical: Use pandas operations (`.rolling()`, `.shift()`, `.rank()`, etc.)

**Critical Rules**:
1. No external imports - use only built-in pandas/numpy operations
2. No look-ahead bias - always use `.shift(1)` or higher for historical data
3. Handle NaN values - use `.fillna()` or `.dropna()`
4. Liquidity filter - ensure average daily volume >150M TWD
5. Rebalancing - support weekly or monthly rebalancing frequencies

**Validation**:
- Code must be executable without syntax errors
- Must handle edge cases (zero divisions, missing data)
- Must be vectorized (no loops over stocks)

## Failure Patterns to Avoid

Based on historical failures, AVOID these patterns:
{failure_patterns}

## Example: Successful Novel Creation

**Champion Approach**: "Momentum-based with ROE filter"

**Novel Strategy** (Different approach: Value + Quality):
```python
def strategy(data):
    # Value: Low P/B ratio
    pb = data.get('fundamental_features:淨值比')

    # Quality: High profit margin
    profit_margin = data.get('fundamental_features:稅後淨利率')

    # Combine: Quality-adjusted value
    value_score = profit_margin / pb.replace(0, float('nan'))

    # Rank and select top 20%
    ranked = value_score.rank(pct=True, ascending=False)

    # Liquidity filter
    volume = data.get('price:成交量')
    liquidity = volume.rolling(20).mean() > 150_000_000

    return (ranked > 0.8) & liquidity
```

**Creation Rationale**: Novel combination of value (P/B) and quality (profit margin).
Uses ranking instead of threshold to adapt to market conditions. Different from
champion's momentum approach.

## Output Format

Provide your strategy code in this exact format:

```python
def strategy(data):
    # Your strategy logic here
    # Include comments explaining key steps

    return position  # Return position series or boolean series
```

**Requirements**:
- Complete, executable Python function
- No syntax errors
- Follows all FinLab constraints
- Includes brief inline comments
- Maximum 50 lines of code
