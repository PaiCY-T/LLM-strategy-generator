{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://finlab.ai/schemas/factor-strategy-v1.json",
  "title": "Factor Strategy Configuration",
  "description": "JSON Schema for declarative factor-based strategy configuration in FinLab. Enables LLMs to generate strategies through YAML/JSON without writing code.",
  "type": "object",
  "required": ["strategy_id", "factors"],
  "properties": {
    "strategy_id": {
      "type": "string",
      "description": "Unique strategy identifier using kebab-case naming convention",
      "pattern": "^[a-z][a-z0-9_-]*$",
      "minLength": 3,
      "maxLength": 64,
      "examples": [
        "momentum-basic-v1",
        "turtle-exit-combo",
        "multi-factor-complex"
      ]
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of the strategy, its goals, and key characteristics",
      "minLength": 10,
      "maxLength": 500,
      "examples": [
        "Basic momentum strategy using RSI and MACD with moving average filter",
        "Turtle trading strategy with ATR-based breakout entry and trailing stop exit"
      ]
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata for strategy tracking and organization",
      "properties": {
        "version": {
          "type": "string",
          "description": "Strategy version following semantic versioning",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "examples": ["1.0.0", "2.1.3"]
        },
        "author": {
          "type": "string",
          "description": "Strategy creator (human or LLM identifier)",
          "maxLength": 100
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of strategy creation"
        },
        "tags": {
          "type": "array",
          "description": "Tags for strategy categorization and search",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_-]*$"
          },
          "uniqueItems": true,
          "maxItems": 10
        },
        "risk_level": {
          "type": "string",
          "enum": ["low", "medium", "high", "very_high"],
          "description": "Subjective risk assessment of the strategy"
        }
      }
    },
    "factors": {
      "type": "array",
      "description": "Ordered list of factors to execute in sequence. Factor outputs become inputs for dependent factors.",
      "items": {
        "$ref": "#/definitions/Factor"
      },
      "minItems": 1,
      "maxItems": 50
    }
  },
  "definitions": {
    "Factor": {
      "type": "object",
      "description": "A single factor instance in the strategy pipeline with unique ID, type, and parameters",
      "required": ["id", "type", "parameters"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique factor instance identifier within this strategy. Used for dependency references.",
          "pattern": "^[a-z][a-z0-9_]*$",
          "minLength": 2,
          "maxLength": 32,
          "examples": [
            "rsi_14",
            "macd_signal",
            "momentum_entry",
            "trailing_stop"
          ]
        },
        "type": {
          "type": "string",
          "description": "Factor type from the FactorRegistry. Must be a registered factor name.",
          "enum": [
            "momentum_factor",
            "ma_filter_factor",
            "revenue_catalyst_factor",
            "earnings_catalyst_factor",
            "atr_factor",
            "breakout_factor",
            "dual_ma_filter_factor",
            "atr_stop_loss_factor",
            "trailing_stop_factor",
            "time_based_exit_factor",
            "volatility_stop_factor",
            "profit_target_factor",
            "composite_exit_factor"
          ]
        },
        "parameters": {
          "type": "object",
          "description": "Factor-specific parameters. Schema depends on factor type. See parameter_schemas below.",
          "additionalProperties": true
        },
        "depends_on": {
          "type": "array",
          "description": "List of factor IDs that this factor depends on. Creates execution ordering. Empty array means no dependencies.",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$"
          },
          "uniqueItems": true,
          "default": []
        },
        "enabled": {
          "type": "boolean",
          "description": "Whether this factor is active. Disabled factors are skipped during execution.",
          "default": true
        }
      }
    },
    "parameter_schemas": {
      "description": "Type-specific parameter schemas for each factor type",
      "momentum_factor": {
        "type": "object",
        "required": ["momentum_period"],
        "properties": {
          "momentum_period": {
            "type": "integer",
            "description": "Lookback period for momentum calculation in days",
            "minimum": 5,
            "maximum": 100,
            "default": 20
          }
        }
      },
      "ma_filter_factor": {
        "type": "object",
        "required": ["ma_periods"],
        "properties": {
          "ma_periods": {
            "type": "integer",
            "description": "Moving average period for trend filter in days",
            "minimum": 10,
            "maximum": 200,
            "default": 60
          }
        }
      },
      "revenue_catalyst_factor": {
        "type": "object",
        "required": ["catalyst_lookback"],
        "properties": {
          "catalyst_lookback": {
            "type": "integer",
            "description": "Lookback window for revenue catalyst detection in months",
            "minimum": 1,
            "maximum": 12,
            "default": 3
          }
        }
      },
      "earnings_catalyst_factor": {
        "type": "object",
        "required": ["catalyst_lookback"],
        "properties": {
          "catalyst_lookback": {
            "type": "integer",
            "description": "Lookback window for earnings catalyst detection in quarters",
            "minimum": 1,
            "maximum": 12,
            "default": 3
          }
        }
      },
      "atr_factor": {
        "type": "object",
        "required": ["atr_period"],
        "properties": {
          "atr_period": {
            "type": "integer",
            "description": "Period for ATR calculation in days",
            "minimum": 5,
            "maximum": 100,
            "default": 20
          }
        }
      },
      "breakout_factor": {
        "type": "object",
        "required": ["entry_window"],
        "properties": {
          "entry_window": {
            "type": "integer",
            "description": "Window for breakout detection in days",
            "minimum": 5,
            "maximum": 100,
            "default": 20
          }
        }
      },
      "dual_ma_filter_factor": {
        "type": "object",
        "required": ["short_ma", "long_ma"],
        "properties": {
          "short_ma": {
            "type": "integer",
            "description": "Short moving average period in days",
            "minimum": 5,
            "maximum": 100,
            "default": 20
          },
          "long_ma": {
            "type": "integer",
            "description": "Long moving average period in days",
            "minimum": 10,
            "maximum": 200,
            "default": 60
          }
        }
      },
      "atr_stop_loss_factor": {
        "type": "object",
        "required": ["atr_multiplier"],
        "properties": {
          "atr_multiplier": {
            "type": "number",
            "description": "Multiplier for ATR-based stop loss distance",
            "minimum": 0.5,
            "maximum": 5.0,
            "default": 2.0
          }
        }
      },
      "trailing_stop_factor": {
        "type": "object",
        "required": ["trail_percent"],
        "properties": {
          "trail_percent": {
            "type": "number",
            "description": "Trailing stop percentage (0.10 = 10%)",
            "minimum": 0.01,
            "maximum": 0.5,
            "default": 0.10
          },
          "activation_profit": {
            "type": "number",
            "description": "Minimum profit to activate trailing stop (0.05 = 5%)",
            "minimum": 0.0,
            "maximum": 0.5,
            "default": 0.05
          }
        }
      },
      "time_based_exit_factor": {
        "type": "object",
        "required": ["max_holding_periods"],
        "properties": {
          "max_holding_periods": {
            "type": "integer",
            "description": "Maximum holding period in days before forced exit",
            "minimum": 1,
            "maximum": 200,
            "default": 20
          }
        }
      },
      "volatility_stop_factor": {
        "type": "object",
        "required": ["std_period", "std_multiplier"],
        "properties": {
          "std_period": {
            "type": "integer",
            "description": "Lookback period for standard deviation calculation in days",
            "minimum": 5,
            "maximum": 100,
            "default": 20
          },
          "std_multiplier": {
            "type": "number",
            "description": "Multiplier for volatility-based stop distance",
            "minimum": 0.5,
            "maximum": 5.0,
            "default": 2.0
          }
        }
      },
      "profit_target_factor": {
        "type": "object",
        "required": ["target_percent"],
        "properties": {
          "target_percent": {
            "type": "number",
            "description": "Profit target percentage for exit (0.30 = 30%)",
            "minimum": 0.05,
            "maximum": 2.0,
            "default": 0.30
          }
        }
      },
      "composite_exit_factor": {
        "type": "object",
        "required": ["exit_signals"],
        "properties": {
          "exit_signals": {
            "type": "array",
            "description": "List of exit signal column names to combine with OR logic",
            "items": {
              "type": "string"
            },
            "minItems": 1,
            "maxItems": 10,
            "uniqueItems": true
          }
        }
      }
    }
  },
  "examples": [
    {
      "strategy_id": "momentum-basic-v1",
      "description": "Basic momentum strategy with RSI and MACD indicators",
      "metadata": {
        "version": "1.0.0",
        "tags": ["momentum", "basic", "rsi", "macd"],
        "risk_level": "medium"
      },
      "factors": [
        {
          "id": "momentum_20",
          "type": "momentum_factor",
          "parameters": {
            "momentum_period": 20
          },
          "depends_on": []
        },
        {
          "id": "ma_filter_60",
          "type": "ma_filter_factor",
          "parameters": {
            "ma_periods": 60
          },
          "depends_on": []
        },
        {
          "id": "trailing_stop",
          "type": "trailing_stop_factor",
          "parameters": {
            "trail_percent": 0.10,
            "activation_profit": 0.05
          },
          "depends_on": ["momentum_20", "ma_filter_60"]
        }
      ]
    },
    {
      "strategy_id": "turtle-exit-combo",
      "description": "Turtle trading with multiple exit conditions",
      "factors": [
        {
          "id": "atr_20",
          "type": "atr_factor",
          "parameters": {
            "atr_period": 20
          },
          "depends_on": []
        },
        {
          "id": "breakout_20",
          "type": "breakout_factor",
          "parameters": {
            "entry_window": 20
          },
          "depends_on": []
        },
        {
          "id": "atr_stop",
          "type": "atr_stop_loss_factor",
          "parameters": {
            "atr_multiplier": 2.0
          },
          "depends_on": ["atr_20"]
        },
        {
          "id": "time_exit",
          "type": "time_based_exit_factor",
          "parameters": {
            "max_holding_periods": 30
          },
          "depends_on": ["breakout_20"]
        },
        {
          "id": "composite_exit",
          "type": "composite_exit_factor",
          "parameters": {
            "exit_signals": ["atr_stop_signal", "time_exit_signal"]
          },
          "depends_on": ["atr_stop", "time_exit"]
        }
      ]
    }
  ]
}
