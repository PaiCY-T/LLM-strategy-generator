# Sector Rotation Strategy
# =========================
# Relative strength sector rotation with factor weighting
#
# Strategy Logic:
# - Calculate relative strength vs market for each sector
# - Rotate into strongest sectors monthly
# - Weight positions by momentum factor strength
# - Use fundamental filters for quality
# - Designed for capturing sector cycles
#
# Expected Performance: Sharpe 1.6-2.2, Annual Return 18-25%, Turnover: Medium
# Market Conditions: Best when sector rotation is active (not all sectors moving together)
# Risk Level: Medium (diversified across sectors)

metadata:
  name: "Relative Strength Sector Rotation"
  description: "Monthly sector rotation strategy selecting strongest sectors by relative performance, factor-weighted positions, with quality filters for stock selection within sectors"
  strategy_type: "momentum"
  rebalancing_frequency: "M"  # Monthly rebalancing
  version: "1.0.0"
  author: "FinLab LLM System"
  tags:
    - sector-rotation
    - relative-strength
    - factor-weighted
    - momentum
    - tactical-allocation
  risk_level: "medium"

indicators:
  # Technical indicators for relative strength
  technical_indicators:
    # Multiple timeframe MAs for trend
    - name: "ma_20"
      type: "SMA"
      period: 20
      source: "data.get('MA_20')"

    - name: "ma_50"
      type: "SMA"
      period: 50
      source: "data.get('MA_50')"

    - name: "ma_100"
      type: "SMA"
      period: 100
      source: "data.get('MA_100')"

    # RSI for momentum
    - name: "rsi_14"
      type: "RSI"
      period: 14
      source: "data.get('RSI_14')"

    # ROC for relative strength calculation
    - name: "roc_20"
      type: "ROC"
      period: 20
      source: "data.get('ROC_20')"

    - name: "roc_60"
      type: "ROC"
      period: 60
      source: "data.get('ROC_60')"

  # Fundamental factors for quality filter
  fundamental_factors:
    # Quality metrics
    - name: "roe"
      field: "ROE"
      source: "data.get('ROE')"

    - name: "operating_margin"
      field: "operating_margin"
      source: "data.get('operating_margin')"

    # Growth metrics
    - name: "revenue_growth"
      field: "revenue_growth"
      source: "data.get('revenue_growth')"

    # Financial health
    - name: "debt_ratio"
      field: "debt_ratio"
      source: "data.get('debt_ratio')"

  # Custom calculations
  custom_calculations:
    # Composite relative strength (20-day + 60-day ROC)
    - name: "relative_strength"
      expression: "(roc_20 * 0.6) + (roc_60 * 0.4)"
      description: "Weighted composite of 20-day (60%) and 60-day (40%) rate of change"

    # Trend score (distance from MAs)
    - name: "trend_score"
      expression: "((close - ma_20) / ma_20) + ((close - ma_50) / ma_50) + ((close - ma_100) / ma_100)"
      description: "Combined distance from 20, 50, and 100-day MAs"

    # Momentum factor (for position weighting)
    - name: "momentum_factor"
      expression: "relative_strength * (1 + rsi_14 / 100)"
      description: "Relative strength adjusted by RSI strength"

    # Quality score
    - name: "quality_score"
      expression: "roe * operating_margin * (1 - debt_ratio)"
      description: "Combined quality metric (profitability Ã— leverage)"

    # Final ranking score
    - name: "rotation_score"
      expression: "momentum_factor * (1 + quality_score)"
      description: "Combined momentum and quality score for sector rotation"

entry_conditions:
  # Ranking-based selection
  ranking_rules:
    # Select top 25% by rotation score
    - field: "rotation_score"
      method: "top_percent"
      value: 25
      ascending: false

  # Threshold-based quality filters
  threshold_rules:
    # Positive relative strength (outperforming)
    - condition: "relative_strength > 0"
      description: "Positive relative strength (outperforming market)"

    # Strong momentum (20-day ROC positive)
    - condition: "roc_20 > 0"
      description: "Positive 20-day momentum"

    # Trend alignment (price above MAs)
    - condition: "close > ma_20"
      description: "Price above 20-day MA"

    - condition: "close > ma_50"
      description: "Price above 50-day MA"

    # RSI showing strength
    - condition: "rsi_14 > 50"
      description: "RSI above 50 (momentum)"

    # Quality filters
    - condition: "roe > 0.12"
      description: "ROE >12% (quality)"

    - condition: "operating_margin > 0.08"
      description: "Operating margin >8% (profitability)"

    - condition: "debt_ratio < 0.65"
      description: "Debt ratio <65% (financial health)"

    # Growth filter
    - condition: "revenue_growth > 0"
      description: "Positive revenue growth"

  # All conditions must be met
  logical_operator: "AND"

  # Liquidity requirements
  min_liquidity:
    average_volume_20d: 80000000  # 80M minimum

exit_conditions:
  # Moderate stop loss
  stop_loss_pct: 0.12  # 12% stop loss

  # Take profit at 30%
  take_profit_pct: 0.30

  # Trailing stop
  trailing_stop:
    trail_percent: 0.12      # Trail 12% below peak
    activation_profit: 0.08  # Activate after 8% profit

  # Conditional exits (rotation reversal)
  conditional_exits:
    # Exit if relative strength turns negative
    - condition: "relative_strength < -0.05"
      description: "Relative strength turned negative (underperforming)"

    # Exit if 20-day momentum negative
    - condition: "roc_20 < -0.03"
      description: "20-day momentum turned negative"

    # Exit if price falls below 50-day MA
    - condition: "close < ma_50"
      description: "Price below 50-day MA (trend broken)"

    # Exit if RSI weakens significantly
    - condition: "rsi_14 < 40"
      description: "RSI weakened below 40"

    # Exit if quality deteriorates
    - condition: "roe < 0.08"
      description: "ROE deteriorated below 8%"

    - condition: "operating_margin < 0.05"
      description: "Operating margin fell below 5%"

  # Monthly holding with buffer
  holding_period_days: 60

  # Exit if ANY exit condition is met
  exit_operator: "OR"

position_sizing:
  # Factor-weighted by momentum strength
  method: "factor_weighted"

  # Maximum 25 positions (diversified rotation)
  max_positions: 25

  # Maximum 8% per position
  max_position_pct: 0.08

  # Minimum 2.5% per position
  min_position_pct: 0.025

  # Weight by rotation score
  weighting_field: "rotation_score"

risk_management:
  # Sector concentration (allow concentration in strong sectors)
  max_sector_exposure: 0.40

  # Rebalance threshold
  rebalance_threshold: 0.15

  # Drawdown limit
  max_drawdown_limit: 0.22

  # Cash reserve
  cash_reserve_pct: 0.05

backtest_config:
  start_date: "2020-01-01"
  end_date: "2023-12-31"
  initial_capital: 1000000
  transaction_cost: 0.001425
  slippage: 0.001
