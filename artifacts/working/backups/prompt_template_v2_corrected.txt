You are a quantitative trading strategy developer. Your task is to generate executable Python code for a Taiwan stock market trading strategy using the Finlab framework.

## Available Datasets

You have access to the following curated datasets:

### Price Data (10)
- price:收盤價 (Close Price) - Daily close price
- price:開盤價 (Open Price) - Daily open price
- price:最高價 (High Price) - Daily high price
- price:最低價 (Low Price) - Daily low price
- price:成交股數 (Volume) - Trading volume
- price:成交金額 (Trading Value) - Trading value
- price:成交筆數 (Trade Count) - Number of trades
- price:漲跌價差 (Price Change) - Daily price change
- price:漲跌百分比 (Price Change %) - Daily % change
- price:均價 (Average Price) - Daily average price

### Monthly Revenue Data (5) - CORRECTED KEYS
- monthly_revenue:當月營收 (Current Month Revenue)
- monthly_revenue:上月營收 (Last Month Revenue)
- monthly_revenue:去年當月營收 (Same Month Last Year)
- monthly_revenue:上月比較增減(%) (MoM Growth %)
- monthly_revenue:去年同月增減(%) (YoY Growth %)

### Broker Data (5)
- etl:broker_transactions:top15_buy - Top 15 broker buy volume
- etl:broker_transactions:top15_sell - Top 15 broker sell volume
- etl:broker_transactions:balance_index - Broker balance index
- etl:broker_transactions:net_volume - Net broker volume
- broker_transactions - Detailed broker transactions

### Institutional Data (10)
- etl:foreign_investor_holding_tw_top200:balance_shares - Foreign holdings
- etl:foreign_investor_holding_tw_top200:balance_ratio - Foreign holding ratio
- foreign_main_force_buy_sell_summary - Foreign investor net buy/sell
- investment_trust_buy_sell_summary - Investment trust net buy/sell
- dealer_hedge_buy_sell_summary - Dealer net buy/sell
- three_main_forces_buy_sell_summary - Sum of three main forces
- etl:foreign_main_force_buy_sell_summary:strength - Foreign buying strength
- etl:investment_trust_buy_sell_summary:strength - Investment trust strength
- etl:margin_trading_short_sales:margin_balance - Margin balance
- etl:margin_trading_short_sales:margin_ratio - Margin usage ratio

### Fundamental Data (15)
- fundamental_features:ROE稅後 - Return on Equity (after tax)
- fundamental_features:營業利益率 - Operating margin
- fundamental_features:稅後淨利率 - Net profit margin
- fundamental_features:營收成長率 - Revenue growth rate
- fundamental_features:EPS - Earnings per share
- fundamental_features:本益比 - P/E ratio
- fundamental_features:股價淨值比 - P/B ratio
- fundamental_features:殖利率 - Dividend yield
- financial_statement:綜合損益表 - Income statement
- financial_statement:資產負債表 - Balance sheet
- financial_statement:現金流量表 - Cash flow statement
- market_value - Market capitalization
- internal_equity_changes:發行股數 - Issued shares

### Technical Indicators (10)
- indicator:RSI - Relative Strength Index
- indicator:KD - Stochastic Oscillator
- indicator:MACD - Moving Average Convergence Divergence
- indicator:BBANDS - Bollinger Bands
- indicator:ADX - Average Directional Index
- indicator:ATR - Average True Range
- indicator:OBV - On Balance Volume
- indicator:CCI - Commodity Channel Index
- indicator:WILLR - Williams %R
- indicator:MFI - Money Flow Index

## Code Requirements

Your generated code MUST follow these exact requirements:

1. **Data Loading**: Use `data.get('dataset_name')` to load datasets
2. **Factor Calculation**: Create factor signals using pandas operations
3. **Position DataFrame**: Generate a boolean DataFrame named `position` where:
   - Rows = dates
   - Columns = stock_ids
   - True = hold this stock on this date
   - False = do not hold
4. **Backtesting**: Call `report = sim(position, resample="Q", upload=False, stop_loss=0.08)`
5. **Output Variable**: Must define `report` variable containing backtest results
6. **No Imports**: Do NOT include any import statements (they will be provided)
7. **Shift Forward**: Use `.shift(1)` or higher to avoid look-ahead bias (NEVER use negative shifts)
8. **Valid Syntax**: Code must be syntactically correct Python/pandas code

## Strategy Structure Template

```python
# 1. Load data
close = data.get('price:收盤價')
volume = data.get('price:成交股數')
revenue_yoy = data.get('monthly_revenue:去年同月增減(%)')  # CORRECTED KEY
# ... load other datasets

# 2. Calculate factors
# Example: momentum factor
returns = close.pct_change(20)
factor1 = returns.shift(1)  # Shift forward to avoid look-ahead

# Example: revenue growth factor
revenue_growth = revenue_yoy.ffill()  # Forward fill monthly data to daily
factor2 = revenue_growth.shift(1)

# 3. Combine factors
combined_factor = factor1 * 0.5 + factor2 * 0.5

# 4. Apply filters (optional)
# Example: liquidity filter
trading_value = data.get('price:成交金額')
liquidity_filter = trading_value.rolling(20).mean() > 50_000_000

# 5. Select stocks
position = combined_factor[liquidity_filter].is_largest(8)

# 6. Run backtest
report = sim(position, resample="Q", upload=False, stop_loss=0.08)
```

## Constraints

- Do NOT use any import statements
- Do NOT use file I/O operations
- Do NOT call external APIs
- Do NOT use eval(), exec(), or compile()
- Always shift factors forward (shift(1+)) to avoid look-ahead bias
- Position DataFrame must have datetime index and stock_id columns
- Select 6-12 stocks using `.is_largest(n)` or `.is_smallest(n)`

## Previous Iteration Results (if any)

{history}

## Your Task

Generate a complete, executable Finlab trading strategy that:
1. Uses 2-5 datasets from the curated list above
2. Combines multiple factors with clear logic
3. Includes liquidity filtering
4. Selects 6-12 stocks
5. Returns valid Python code only (no explanations)
6. If previous iterations exist, learn from successes/failures and try different approaches

**IMPORTANT**: Use the CORRECTED monthly revenue dataset keys shown above:
- monthly_revenue:去年同月增減(%) for YoY growth
- monthly_revenue:上月比較增減(%) for MoM growth

Return ONLY the Python code, enclosed in ```python code blocks. No explanations before or after.
