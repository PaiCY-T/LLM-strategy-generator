{
  "records": [
    {
      "iteration_num": 0,
      "timestamp": "2025-10-11T22:43:20.890377",
      "model": "google/gemini-2.5-flash",
      "code": "# 1. Load data\nclose = data.get('price:收盤價')\ntrading_value = data.get('price:成交金額')\nvolume = data.get('price:成交股數')\nroe = data.get('fundamental_features:ROE稅後')\nrevenue_yoy = data.get('monthly_revenue:去年同月增減(%)')\nforeign_net_buy = data.get('institutional_investors_trading_summary:外陸資買賣超股數(不含外資自營商)')\nrsi = data.indicator('RSI')\npe_ratio = data.get('price_earning_ratio:本益比')\n\n# 2. Calculate factors\n# Factor 1: Price Momentum (60-day returns)\nmomentum = close.pct_change(60).shift(1)\n\n# Factor 2: Quality (ROE, 4-quarter average)\n# Use .ffill() for quarterly data\nquality = roe.ffill().rolling(4).mean().shift(1)\n\n# Factor 3: Revenue Growth (monthly YoY, 3-month average)\n# Use .ffill() for monthly data\nrevenue_growth = revenue_yoy.ffill().rolling(3).mean().shift(1)\n\n# Factor 4: Institutional Buying Strength (20-day sum of foreign net buy)\ninstitutional_flow = foreign_net_buy.rolling(20).sum().shift(1)\n\n# Factor 5: Value (Inverse of P/E ratio)\n# Cap P/E ratio to avoid extreme values and take inverse for value factor\nvalue_factor = (1 / pe_ratio.mask(pe_ratio <= 0)).shift(1)\n\n# 3. Combine factors (normalize first!)\nmomentum_rank = momentum.rank(axis=1, pct=True)\nquality_rank = quality.rank(axis=1, pct=True)\nrevenue_growth_rank = revenue_growth.rank(axis=1, pct=True)\ninstitutional_flow_rank = institutional_flow.rank(axis=1, pct=True)\nvalue_rank = value_factor.rank(axis=1, pct=True)\n\n# Combine with weights\ncombined_factor = (momentum_rank * 0.30 +\n                   quality_rank * 0.25 +\n                   revenue_growth_rank * 0.20 +\n                   institutional_flow_rank * 0.15 +\n                   value_rank * 0.10)\n\n# 4. Apply filters\n# Liquidity filter: Average daily trading value over 20 days > 50 million TWD\nliquidity_filter = trading_value.rolling(20).mean().shift(1) > 50_000_000\n\n# Price filter: Close price > 20 TWD to avoid penny stocks\nprice_filter = close.shift(1) > 20\n\n# RSI filter: RSI between 30 and 70 to avoid extreme overbought/oversold conditions\nrsi_filter = (rsi.shift(1) > 30) & (rsi.shift(1) < 70)\n\n# P/E Ratio filter: P/E ratio less than 30 for reasonable valuation\npe_filter = pe_ratio.shift(1) < 30\n\n# Apply all filters\nfiltered_factor = combined_factor[liquidity_filter & price_filter & rsi_filter & pe_filter]\n\n# 5. Select stocks\n# Select top 10 stocks based on the combined factor score\nposition = filtered_factor.is_largest(10)\n\n# 6. Run backtest\nreport = sim(position, resample=\"Q\", upload=False, stop_loss=0.08)",
      "validation_passed": true,
      "validation_errors": [],
      "execution_success": false,
      "execution_error": "AttributeError: 'NoneType' object has no attribute 'get'",
      "metrics": null,
      "feedback": "✅ Validation: PASSED - Code meets all security requirements\n\n❌ Execution: FAILED\nError: AttributeError: 'NoneType' object has no attribute 'get'\n\nLikely cause: Invalid dataset key or data object is None\nCheck that all data.get() keys match available datasets\n"
    },
    {
      "iteration_num": 1,
      "timestamp": "2025-10-11T22:43:25.560301",
      "model": "google/gemini-2.5-flash",
      "code": "# 1. Load data\nclose = data.get('price:收盤價')\ntrading_value = data.get('price:成交金額')\nvolume = data.get('price:成交股數')\nroe = data.get('fundamental_features:ROE稅後')\nrevenue_yoy = data.get('monthly_revenue:去年同月增減(%)')\nforeign_net_buy = data.get('institutional_investors_trading_summary:外陸資買賣超股數(不含外資自營商)')\nrsi = data.indicator('RSI')\n\n# 2. Calculate factors\n# Factor 1: Price Momentum (60-day returns)\nmomentum = close.pct_change(60).shift(1)\n\n# Factor 2: Quality (ROE, 4-quarter average)\n# ffill() to align quarterly data to daily, then shift(1)\nquality = roe.ffill().rolling(window=4, min_periods=1).mean().shift(1)\n\n# Factor 3: Revenue Growth (Monthly YoY, 3-month average)\n# ffill() to align monthly data to daily, then shift(1)\nrevenue_growth = revenue_yoy.ffill().rolling(window=3, min_periods=1).mean().shift(1)\n\n# Factor 4: Institutional Buying Strength (20-day sum of foreign net buy)\ninstitutional_flow = foreign_net_buy.rolling(window=20, min_periods=1).sum().shift(1)\n\n# Factor 5: RSI Divergence (Simple RSI filter, not a continuous factor)\n# This will be used as an additional filter rather than a continuous factor for combination\n\n# 3. Combine factors (normalize first!)\nmomentum_rank = momentum.rank(axis=1, pct=True)\nquality_rank = quality.rank(axis=1, pct=True)\nrevenue_growth_rank = revenue_growth.rank(axis=1, pct=True)\ninstitutional_flow_rank = institutional_flow.rank(axis=1, pct=True)\n\n# Combine with weights. Higher weight on momentum and quality.\ncombined_factor = (momentum_rank * 0.40 +\n                   quality_rank * 0.30 +\n                   revenue_growth_rank * 0.15 +\n                   institutional_flow_rank * 0.15)\n\n# 4. Apply filters\n# Liquidity filter: Average daily trading value over 20 days > 50 million TWD\nliquidity_filter = trading_value.rolling(window=20, min_periods=1).mean().shift(1) > 50_000_000\n\n# Price filter: Close price > 20 TWD to avoid penny stocks\nprice_filter = close.shift(1) > 20\n\n# Volume filter: Average daily volume over 20 days > 500,000 shares\nvolume_filter = volume.rolling(window=20, min_periods=1).mean().shift(1) > 500_000\n\n# RSI filter: RSI not overbought (below 70) and not oversold (above 30)\nrsi_filter = (rsi.shift(1) < 70) & (rsi.shift(1) > 30)\n\n# Apply all filters\nfiltered_factor = combined_factor[liquidity_filter & price_filter & volume_filter & rsi_filter]\n\n# 5. Select stocks\n# Select top 10 stocks based on the filtered combined factor\nposition = filtered_factor.is_largest(10)\n\n# 6. Run backtest\nreport = sim(position, resample=\"Q\", upload=False, stop_loss=0.08)",
      "validation_passed": true,
      "validation_errors": [],
      "execution_success": false,
      "execution_error": "AttributeError: 'NoneType' object has no attribute 'get'",
      "metrics": null,
      "feedback": "✅ Validation: PASSED - Code meets all security requirements\n\n❌ Execution: FAILED\nError: AttributeError: 'NoneType' object has no attribute 'get'\n\nLikely cause: Invalid dataset key or data object is None\nCheck that all data.get() keys match available datasets\n"
    },
    {
      "iteration_num": 2,
      "timestamp": "2025-10-11T22:43:30.341109",
      "model": "google/gemini-2.5-flash",
      "code": "# 1. Load data\nclose = data.get('price:收盤價')\ntrading_value = data.get('price:成交金額')\nvolume = data.get('price:成交股數')\nrevenue_yoy = data.get('monthly_revenue:去年同月增減(%)')\nroe = data.get('fundamental_features:ROE稅後')\nforeign_net_buy = data.get('institutional_investors_trading_summary:外陸資買賣超股數(不含外資自營商)')\npe_ratio = data.get('price_earning_ratio:本益比')\nrsi = data.indicator('RSI')\n\n# 2. Calculate factors\n# Factor 1: Price Momentum (60-day returns)\nmomentum = close.pct_change(60).shift(1)\n\n# Factor 2: Revenue Growth (monthly data aligned to daily, 3-month average)\nrevenue_growth = revenue_yoy.ffill().rolling(3).mean().shift(1)\n\n# Factor 3: Quality (ROE with 4-quarter smoothing)\nquality = roe.ffill().rolling(4).mean().shift(1)\n\n# Factor 4: Institutional Flow (20-day sum of foreign net buy)\ninstitutional_flow = foreign_net_buy.rolling(20).sum().shift(1)\n\n# Factor 5: Value (Inverse of P/E ratio, capped to avoid outliers)\n# Cap P/E ratio to prevent extremely low values from dominating\npe_capped = pe_ratio.shift(1).clip(upper=30)\nvalue = (1 / pe_capped)\n\n# Factor 6: RSI Reversal (RSI below 30 indicates oversold)\n# This factor will be used as a filter or given a small weight\nrsi_oversold = (rsi.shift(1) < 30).astype(float)\n\n# 3. Combine factors (normalize first!)\nmomentum_rank = momentum.rank(axis=1, pct=True)\nrevenue_rank = revenue_growth.rank(axis=1, pct=True)\nquality_rank = quality.rank(axis=1, pct=True)\nflow_rank = institutional_flow.rank(axis=1, pct=True)\nvalue_rank = value.rank(axis=1, pct=True)\n\n# Combine with meaningful weights\ncombined_factor = (momentum_rank * 0.30 +\n                   revenue_rank * 0.20 +\n                   quality_rank * 0.20 +\n                   flow_rank * 0.15 +\n                   value_rank * 0.15)\n\n# 4. Apply filters\n# Liquidity filter: Average daily trading value over 20 days > 50M TWD\nliquidity_filter = trading_value.rolling(20).mean().shift(1) > 50_000_000\n\n# Price filter: Close price > 20 TWD to avoid penny stocks\nprice_filter = close.shift(1) > 20\n\n# P/E ratio filter: P/E between 5 and 25 for reasonable valuation\npe_filter = (pe_ratio.shift(1) > 5) & (pe_ratio.shift(1) < 25)\n\n# Volume filter: Average daily volume over 20 days > 1,000,000 shares\nvolume_filter = volume.rolling(20).mean().shift(1) > 1_000_000\n\n# Apply all filters\nfiltered_factor = combined_factor[liquidity_filter & price_filter & pe_filter & volume_filter]\n\n# 5. Select stocks\n# Select top 10 stocks based on the combined factor score\nposition = filtered_factor.is_largest(10)\n\n# 6. Run backtest\nreport = sim(position, resample=\"Q\", upload=False, stop_loss=0.08)",
      "validation_passed": true,
      "validation_errors": [],
      "execution_success": false,
      "execution_error": "AttributeError: 'NoneType' object has no attribute 'get'",
      "metrics": null,
      "feedback": "✅ Validation: PASSED - Code meets all security requirements\n\n❌ Execution: FAILED\nError: AttributeError: 'NoneType' object has no attribute 'get'\n\nLikely cause: Invalid dataset key or data object is None\nCheck that all data.get() keys match available datasets\n"
    }
  ]
}