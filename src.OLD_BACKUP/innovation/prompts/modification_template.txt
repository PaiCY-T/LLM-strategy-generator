# Task: Modify Champion Strategy to Improve Performance

You are an expert quantitative researcher specializing in Taiwan stock market strategies.
Your task is to modify the current champion strategy to improve its performance metrics.

**Instructions**:
- Preserve successful patterns from the champion
- Make targeted improvements to boost the target metric
- Maintain all FinLab API constraints
- Ensure no look-ahead bias
- Keep the strategy executable and robust

## Current Champion Strategy

**Performance**:
- Sharpe Ratio: {sharpe_ratio}
- Max Drawdown: {max_drawdown}
- Win Rate: {win_rate}
- Calmar Ratio: {calmar_ratio}

**Success Factors to Preserve**:
{success_factors}

**Code Preview**:
```python
{champion_code}
```

## Optimization Target

**Primary Goal**: Improve {target_metric}
- Current: {current_value}
- Target: >{target_value} (+10% improvement)

**Constraints**:
- Maintain Max Drawdown <25%
- Maintain Win Rate >45%
- Preserve liquidity requirements (>150M TWD)

## FinLab API Constraints

**Required Function Signature**:
```python
def strategy(data):
    # Your strategy logic here
    # Must return: position series or stock selection boolean series
    return position
```

**Data Access** (Taiwan Stock Market):
- Price: `data.get('price:收盤價')`, `data.get('price:開盤價')`, `data.get('price:成交量')`
- Fundamentals: `data.get('fundamental_features:ROE稅後')`, `data.get('fundamental_features:本益比')`,
  `data.get('fundamental_features:營收成長率')`, `data.get('fundamental_features:負債比率')`
- Technical: Use pandas operations (`.rolling()`, `.shift()`, `.rank()`, etc.)

**Critical Rules**:
1. No external imports - use only built-in pandas/numpy operations
2. No look-ahead bias - always use `.shift(1)` or higher for historical data
3. Handle NaN values - use `.fillna()` or `.dropna()`
4. Liquidity filter - ensure average daily volume >150M TWD
5. Rebalancing - support weekly or monthly rebalancing frequencies

**Validation**:
- Code must be executable without syntax errors
- Must handle edge cases (zero divisions, missing data)
- Must be vectorized (no loops over stocks)

## Failure Patterns to Avoid

Based on historical failures, AVOID these patterns:
{failure_patterns}

## Example: Successful Modification

**Original Champion**:
```python
def strategy(data):
    # High ROE filter
    roe = data.get('fundamental_features:ROE稅後')
    return roe > 15
```
Sharpe: 0.75, MDD: 18%

**Modified Version** (Improvement: +15% Sharpe):
```python
def strategy(data):
    # Add growth filter to high ROE
    roe = data.get('fundamental_features:ROE稅後')
    growth = data.get('fundamental_features:營收成長率')

    # Combine quality (ROE) with growth momentum
    quality_growth = (roe > 15) & (growth > 0.1)

    # Add liquidity filter
    volume = data.get('price:成交量')
    liquidity = volume.rolling(20).mean() > 150_000_000

    return quality_growth & liquidity
```
Sharpe: 0.86 (+15%), MDD: 16%

**Modification Rationale**: Added growth filter to improve returns while maintaining
quality focus. Liquidity filter reduces transaction costs.

## Output Format

Provide your strategy code in this exact format:

```python
def strategy(data):
    # Your strategy logic here
    # Include comments explaining key steps

    return position  # Return position series or boolean series
```

**Requirements**:
- Complete, executable Python function
- No syntax errors
- Follows all FinLab constraints
- Includes brief inline comments
- Maximum 50 lines of code
