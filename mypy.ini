# mypy.ini - Type Checking Configuration for API Mismatch Prevention System
#
# This configuration implements Phase 5A.1 requirements from the API Mismatch
# Prevention System specification. It enforces strict type checking on new
# learning modules while maintaining lenient mode for legacy backtest modules.
#
# Philosophy: Gradual migration with strict enforcement on new code
# - Strict mode for src/learning/* (new Protocol-based architecture)
# - Lenient mode for src/backtest/* (legacy modules)
# - Runtime validation at module boundaries (Layer 3.5)
#
# Reference: .spec-workflow/specs/api-mismatch-prevention-system/DESIGN_IMPROVEMENTS.md

[mypy]
# Python version
python_version = 3.11

# Global strict settings (applied to all modules by default)
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
strict = True

# Error reporting configuration
show_error_codes = True
pretty = True
show_column_numbers = True
show_error_context = True

# Helpful warnings
warn_unused_ignores = True
warn_redundant_casts = True
warn_unreachable = True
warn_no_return = True

# === Phase 1-4 modules: Full strict enforcement ===
# New learning modules with Protocol-based architecture and runtime validation
[mypy-src.learning.*]
strict = True
disallow_untyped_defs = True
warn_return_any = True
# Enforce type hints on all functions and methods
disallow_incomplete_defs = True
# Check untyped function bodies
check_untyped_defs = True

# === Legacy modules: Warnings only (gradual migration) ===
# Existing backtest modules that will be migrated gradually
[mypy-src.backtest.*]
strict = False
warn_unused_ignores = False
# Suppress untyped function warnings to reduce noise from legacy code
check_untyped_defs = False
# Allow incomplete type annotations in legacy modules
disallow_untyped_defs = False
disallow_incomplete_defs = False

# === Third-party libraries without type stubs ===
# FinLab library and dependencies
[mypy-finlab.*]
ignore_missing_imports = True

[mypy-pandas.*]
ignore_missing_imports = True

[mypy-numpy.*]
ignore_missing_imports = True

[mypy-matplotlib.*]
ignore_missing_imports = True

[mypy-scipy.*]
ignore_missing_imports = True

[mypy-sklearn.*]
ignore_missing_imports = True

[mypy-backtesting.*]
ignore_missing_imports = True

[mypy-yaml.*]
ignore_missing_imports = True

[mypy-anthropic.*]
ignore_missing_imports = True

[mypy-openai.*]
ignore_missing_imports = True

# === Future Enhancement Notes ===
#
# Migration path for legacy modules (src/backtest.*):
# 1. Add type hints to public interfaces (3-5 hours per module)
# 2. Enable check_untyped_defs = True for specific modules
# 3. Gradually increase strictness as confidence grows
# 4. Final goal: strict = True for entire codebase
#
# Estimated timeline: 6-12 months for full migration
# Priority: Core modules first (executor, engine, classifier)
