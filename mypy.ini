# mypy.ini - Type Checking Configuration (Hybrid Approach)
#
# This configuration adopts a LENIENT strategy for gradual type adoption
# aligned with the "避免過度工程化" principle. It focuses on catching critical
# API mismatches without imposing strict type requirements everywhere.
#
# Philosophy: Practical type safety for personal trading system
# - Catch missing parameters and type mismatches
# - Allow gradual adoption (no requirement for 100% coverage)
# - Minimize friction for rapid iteration
#
# Implementation: Hybrid Approach (12-16 hours vs Full Spec 30-40 hours)
# - Type hints on 4 core modules only
# - NO Protocol interfaces (simplified architecture)
# - NO CI integration initially (local checks only)
# - Focuses on Phase 8 error prevention

[mypy]
# Python version
python_version = 3.10

# Target modules for type checking (4 core modules only)
files = src/learning/iteration_history.py, src/learning/champion_tracker.py, src/learning/iteration_executor.py, src/backtest/executor.py

# === LENIENT SETTINGS FOR GRADUAL ADOPTION ===

# Allow untyped function definitions (do not require type hints on ALL functions)
disallow_untyped_defs = False

# Allow incomplete type annotations (some parameters can remain untyped)
disallow_incomplete_defs = False

# Don't warn when functions return 'Any' type
warn_return_any = False

# Don't require return type for simple functions
check_untyped_defs = False

# === HELPFUL WARNINGS (Keep these enabled) ===

# Warn on unnecessary '# type: ignore' comments (cleanup code)
warn_unused_ignores = True

# Warn on redundant casts
warn_redundant_casts = True

# Warn when overriding method signature without proper typing
warn_unreachable = True

# === ERROR REPORTING (Better developer experience) ===

# Show error codes (e.g., [arg-type], [attr-defined])
show_error_codes = True

# Colorful output for readability
pretty = True

# Show column numbers in errors (easier navigation)
show_column_numbers = True

# Show context around errors
show_error_context = True

# === THIRD-PARTY LIBRARY IGNORES ===
# These libraries don't have type stubs, so ignore import errors

[mypy-finlab.*]
ignore_missing_imports = True

[mypy-pandas.*]
ignore_missing_imports = True

[mypy-numpy.*]
ignore_missing_imports = True

[mypy-matplotlib.*]
ignore_missing_imports = True

[mypy-scipy.*]
ignore_missing_imports = True

[mypy-sklearn.*]
ignore_missing_imports = True

[mypy-backtesting.*]
ignore_missing_imports = True

[mypy-yaml.*]
ignore_missing_imports = True

[mypy-anthropic.*]
ignore_missing_imports = True

[mypy-openai.*]
ignore_missing_imports = True

# === FUTURE ENHANCEMENT (Currently disabled for gradual adoption) ===
#
# When ready to tighten type checking (6+ months after initial adoption):
# 1. Enable disallow_untyped_defs = True (require type hints on new functions)
# 2. Enable disallow_incomplete_defs = True (require complete annotations)
# 3. Enable warn_return_any = True (catch accidental 'Any' returns)
# 4. Expand files to all src/ modules
#
# Estimated effort for full strictness: +20-30 hours
# ROI: Better IDE autocomplete, 30% fewer runtime errors
#
# Decision criteria:
# - Multiple developers working on codebase
# - Planning to add complex new features
# - System has grown beyond 10,000 LOC
