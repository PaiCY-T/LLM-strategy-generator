{
  "id": "snapshot_1761660711947_75j3hz8y6",
  "approvalId": "approval_1761635285498_b5jwwl9nv",
  "approvalTitle": "Product Steering Document - LLM Core Capability Update",
  "version": 3,
  "timestamp": "2025-10-28T14:11:51.947Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Product Overview\n\n## Product Purpose\n\nFinlab Backtesting Optimization System æ˜¯ä¸€å€‹ **LLM-driven** æ™ºèƒ½äº¤æ˜“ç­–ç•¥å›žæ¸¬èˆ‡å„ªåŒ–å¹³å°ï¼Œå°ˆç‚ºé€±/æœˆäº¤æ˜“é€±æœŸçš„å€‹äººé‡åŒ–äº¤æ˜“è€…è¨­è¨ˆã€‚ç³»çµ±æ ¸å¿ƒå‰µæ–°æ˜¯é€éŽ **å¤§åž‹èªžè¨€æ¨¡åž‹ (LLM) é©…å‹•çš„çµæ§‹åŒ–å‰µæ–°**ï¼Œçµåˆå¤šå±¤é©—è­‰æ¡†æž¶ï¼Œå¯¦ç¾çªç ´æ€§çš„ç­–ç•¥æ€§èƒ½æå‡ã€‚\n\nThe system transforms autonomous strategy generation through **three evolutionary stages**:\n- **Stage 0 (Random)**: 33% success rate - Bootstrap exploration\n- **Stage 1 (Champion-Based)**: 70% success rate - Single best strategy refinement (MVP baseline)\n- **Stage 2 (LLM + Population)**: >80% target - **Hybrid innovation (20% LLM + 80% Factor Graph)**\n\n**Core Innovation**: LLM generates structured YAML strategy specifications (90% success rate), validated through 7-layer safety framework, enabling discovery of novel trading patterns beyond predefined templates.\n\n## Current Status (2025-10-28)\n\n### Stage 1 (MVP Baseline) âœ… ACHIEVED\n- **Success Rate**: 70% (target: >60%)\n- **Average Sharpe**: 1.15 (target: >0.5)\n- **Best Sharpe**: 2.48 (target: >1.0)\n- **Method**: Champion-based learning with template optimization\n\n### Stage 2 (LLM + Population) â³ IMPLEMENTATION COMPLETE, ACTIVATION PENDING\n- **LLM Innovation Status**: âœ… Fully implemented (Phase 2-3), âš ï¸ **Disabled by default** (`config/learning_system.yaml:708`)\n- **Reason for Default Disabled**: Backward compatibility during Phase 1 development\n- **Components Ready**:\n  - âœ… InnovationEngine (src/innovation/innovation_engine.py)\n  - âœ… Structured YAML pipeline (YAMLSchemaValidator, YAMLToCodeGenerator)\n  - âœ… 7-Layer validation framework\n  - âœ… Auto-fallback to Factor Graph\n- **Next Step**: Phased activation (dry-run â†’ 5% â†’ 20% innovation rate)\n\n### Phase1 Smoke Test Results Explained (2025-10-28)\n**Test Configuration**: 10 generations, 30 individuals, LLM disabled\n**Results**: 0.5% champion update rate, 1.1558 Sharpe, diversity collapsed to 10.4%\n\n**Root Cause**: LLM innovation disabled â†’ System limited to 13 predefined factors â†’ Rapid convergence â†’ Early peak (Gen 1) â†’ No improvement\n\n**Expected with LLM Enabled**:\n- Diversity maintained >40% (vs collapsed 10.4%)\n- Champion update rate 10-20% (vs 0.5%)\n- Breakthrough potential >2.5 Sharpe (vs plateau 1.1558)\n- Continuous structural innovation (vs parameter perturbation only)\n\n## Target Users\n\n**Primary User**: å€‹äººé‡åŒ–äº¤æ˜“è€…ï¼ˆIndividual Quantitative Tradersï¼‰\n\n**User Profile**:\n- ä½¿ç”¨é€±/æœˆäº¤æ˜“é€±æœŸé€²è¡ŒæŠ•è³‡æ±ºç­–\n- å…·å‚™ Python ç¨‹å¼è¨­è¨ˆèƒ½åŠ›\n- ç†Ÿæ‚‰å°ç£è‚¡å¸‚ç‰¹æ€§ï¼ˆTAIEX, 0050, èžè³‡èžåˆ¸ç­‰ï¼‰\n- è¿½æ±‚ç©©å®šçš„é¢¨éšªèª¿æ•´å ±é…¬ï¼ˆSharpe ratio >1.0ï¼‰\n- æ™‚é–“æœ‰é™ï¼Œéœ€è¦è‡ªå‹•åŒ–ç­–ç•¥å„ªåŒ–\n\n**User Pain Points**:\n1. **æ‰‹å‹•ç­–ç•¥èª¿å„ªè€—æ™‚**: ç¼ºä¹è‡ªå‹•åŒ–æ©Ÿåˆ¶ï¼Œéœ€äººå·¥èª¿æ•´åƒæ•¸\n2. **æ€§èƒ½ä¸ç©©å®š**: ç­–ç•¥è¡¨ç¾æ³¢å‹•å¤§ï¼Œç„¡æ³•æŒçºŒå„ªåŒ–\n3. **ç„¡æ³•å¾žå¤±æ•—ä¸­å­¸ç¿’**: é‡è¤‡ç›¸åŒéŒ¯èª¤ï¼Œæµªè²»è¿­ä»£æˆæœ¬\n4. **ç¼ºä¹æž¶æ§‹æŒ‡å°Ž**: éŽåº¦å·¥ç¨‹åŒ–æˆ–æž¶æ§‹æ··äº‚å½±éŸ¿é–‹ç™¼æ•ˆçŽ‡\n\n## Key Features\n\n### 1. **ðŸ¤– LLM-Driven Innovation Engine** â­ **CORE CAPABILITY**\nHybrid innovation model combining LLM structural creativity with Factor Graph safety\n- **20% LLM Innovation**: Structured YAML strategy generation (90% success rate)\n  - InnovationEngine: OpenRouter/Gemini/OpenAI integration\n  - PromptBuilder: Context-aware strategy generation\n  - FeedbackProcessor: Learning from validation failures\n- **80% Factor Graph Mutations**: Safe fallback with 13 predefined factors\n  - Automatic fallback on LLM failures\n  - Maintains diversity through hybrid exploration\n- **7-Layer Validation Framework**: Comprehensive safety checks\n  - Syntax â†’ Semantic â†’ Security â†’ Backtestability â†’ Metrics â†’ Multi-Objective â†’ Baseline\n- **Current Status**: âœ… Implemented (Phase 2-3 complete), â³ Activation pending\n- **Specifications**: llm-integration-activation, structured-innovation-mvp\n\n### 2. **è‡ªä¸»å­¸ç¿’ç³»çµ±** (Autonomous Learning System)\nChampion tracking with success pattern preservation and failure avoidance\n- ðŸ† Champion tracking: è‡ªå‹•ä¿å­˜ä¸¦è¿½è¹¤æœ€ä½³è¡¨ç¾ç­–ç•¥\n- ðŸŽ¯ Performance attribution: è­˜åˆ¥æˆåŠŸå› ç´ èˆ‡å¤±æ•—æ¨¡å¼\n- ðŸ§¬ Evolutionary constraints: Preserve proven elements while exploring improvements\n- âœ… MVP Validated: 70% success rate (Stage 1), 1.15 avg Sharpe, 2.48 best Sharpe\n\n### 3. **æ¨¡æ¿ç³»çµ±** (Template System)\nDomain-specific strategy templates with intelligent recommendation\n- ðŸ“‹ 4 proven templates: Turtle, Mastiff, Factor, Momentum\n- ðŸ¤– Performance-based selection: Sharpe tier-based recommendations\n- ðŸ”„ Template diversity: Forced exploration every 5th iteration\n- ðŸ“Š Analytics tracking: Usage statistics and success rate monitoring\n\n### 4. **å› å­åœ–ç³»çµ±** (Factor Graph System)\nCentralized factor library with compositional strategy building\n- ðŸ—ï¸ 13 reusable factors: Momentum, Value, Quality, Risk, Entry, Exit\n- ðŸ” Factor discovery: Category-based search and validation\n- âš¡ High performance: 7-200x faster than targets\n- ðŸ§© Strategy composition: Flexible factor combination and dependencies\n\n### 5. **å¤šå±¤é©—è­‰ç³»çµ±** (Multi-Layer Validation System)\nComprehensive validation to prevent overfitting and ensure robustness\n- ðŸ“Š Train/Val/Test split: Prevent overfitting with separate periods\n- ðŸ”„ Walk-forward analysis: Rolling window validation\n- ðŸ“‰ Bootstrap confidence intervals: Statistical significance testing\n- ðŸŽ¯ Baseline comparison: Beat Buy-and-Hold 0050 benchmark\n- ðŸ§® Bonferroni correction: Multiple comparison adjustment\n\n### 6. **ç©©å®šæ€§æ©Ÿåˆ¶** (Stability Mechanisms)\nAdvanced features ensuring reliable long-term autonomous learning\n- ðŸ“ˆ Variance monitoring: Convergence tracking and instability detection\n- âœ… Preservation validation: Prevent performance regressions\n- ðŸ›¡ï¸ Anti-churn management: Dynamic thresholds prevent excessive updates\n- â®ï¸ Rollback management: Safe rollback to previous champion strategies\n\n## Business Objectives\n\n### Primary Objectives\n1. **é”æˆStage 2çªç ´**: Activate LLM innovation to achieve >80% success rate and Sharpe >2.5\n2. **ç¶­æŒç¨®ç¾¤å¤šæ¨£æ€§**: Maintain diversity >40% through LLM structural innovation\n3. **æå‡ç­–ç•¥æ€§èƒ½**: Achieve consistent Sharpe ratio >1.2 by iteration 10 (Stage 1: âœ… Achieved)\n4. **å¢žåŠ æˆåŠŸçŽ‡**: Increase from Stage 1 (70%) â†’ Stage 2 (>80%)\n5. **æ¶ˆé™¤æ€§èƒ½é€€åŒ–**: Eliminate >10% performance regressions after champion established\n\n### Secondary Objectives\n1. **çŸ¥è­˜ç´¯ç©**: Build reusable factor library and proven templates\n2. **é–‹ç™¼æ•ˆçŽ‡**: Reduce manual parameter tuning and strategy debugging time\n3. **ç³»çµ±ç©©å®šæ€§**: Maintain 926+ passing tests with >80% code coverage\n4. **å¯ç¶­è­·æ€§**: Follow project principle \"é¿å…éŽåº¦å·¥ç¨‹åŒ–\"\n\n## Success Metrics\n\n### Performance Metrics\n- **Sharpe Ratio**: Target >1.2, Best achieved: 2.48 âœ…\n- **Success Rate**: Target >60%, Achieved: 70% âœ…\n- **Average Sharpe**: Target >0.5, Achieved: 1.15 âœ…\n- **Champion Update Rate**: Target 10-20% (balanced exploration/exploitation)\n\n### Learning Metrics\n- **Convergence**: Variance Ïƒ <0.5 after iteration 10\n- **Regression Prevention**: <10% degradation after champion established\n- **Template Diversity**: â‰¥80% unique strategies in 10 iterations\n- **Preservation Accuracy**: >90% detection of critical parameter changes\n\n### System Quality Metrics\n- **Test Coverage**: >80% code coverage, 926+ tests passing âœ…\n- **Validation Pass Rate**: â‰¥90% for generated strategies\n- **Metric Extraction**: <0.01 error accuracy vs actual backtest âœ…\n- **Performance**: Attribution analysis <100ms, validation <5s âœ…\n\n### Business Impact Metrics\n- **Time Savings**: 50% reduction via metric extraction optimization âœ…\n- **Iteration Efficiency**: 5-7 iterations vs. unpredictable random walk\n- **Code Quality**: 153 Python files, 4.8MB organized codebase\n- **Documentation**: ä¸­è‹±é›™èªžæ”¯æŒï¼Œcomprehensive API docs\n\n## Product Principles\n\n### 1. **é¿å…éŽåº¦å·¥ç¨‹åŒ–** (Avoid Over-Engineering)\nKeep implementation simple and pragmatic, aligned with personal-use context\n- ä½¿ç”¨ 80/20 åŽŸå‰‡ï¼šMVP-quality solutions for non-critical paths (e.g., regex vs. AST)\n- å°ˆæ³¨æ–¼é€±/æœˆäº¤æ˜“é€±æœŸï¼Œä¸è¿½æ±‚æ—¥å…§äº¤æ˜“è¤‡é›œæ€§\n- å„ªå…ˆå¯¦ç”¨æ€§å‹éŽå®Œç¾Žæ€§ï¼šå¿«é€Ÿè¿­ä»£å‹éŽå®Œç¾Žè¨­è¨ˆ\n\n### 2. **å¾žæ•¸æ“šä¸­å­¸ç¿’** (Learn from Data)\nLet empirical evidence guide decisions, not assumptions\n- Champion tracking based on actual Sharpe performance\n- Template recommendations driven by historical success rates\n- Validation criteria calibrated to Taiwan market characteristics\n- Failure patterns automatically extracted and avoided\n\n### 3. **æ¼¸é€²å¼æ”¹é€²** (Incremental Improvement)\nBuild upon success systematically rather than random exploration\n- Preserve proven elements (ROE smoothing, liquidity filters)\n- Â±10-20% parameter adjustments for stable evolution\n- Forced exploration every 5th iteration to prevent local optima\n- Multi-objective validation (Sharpe + Calmar + Drawdown)\n\n### 4. **è‡ªå‹•åŒ–å„ªå…ˆ** (Automation First)\nMinimize manual intervention through intelligent automation\n- Autonomous loop operates without human input\n- Template recommendation fully automated (performance + champion + validation)\n- Metric extraction with 3-method fallback chain\n- Rollback system with automatic validation\n\n### 5. **å¯è§€å¯Ÿæ€§** (Observability)\nComprehensive tracking and monitoring for debugging and optimization\n- 926 tests with detailed coverage reports\n- Iteration history with full metrics and code persistence\n- Hall of Fame repository for champion strategies\n- Template analytics with usage trends and success rates\n- JSON logging for performance analysis\n\n### 6. **å‘å¾Œå…¼å®¹** (Backward Compatibility)\nPreserve existing functionality while adding new capabilities\n- 100% backward compatibility maintained across all phases âœ…\n- Migration system with automatic backup before changes\n- Graceful degradation when champion or validation unavailable\n- Fallback mechanisms for all critical paths\n\n## Monitoring & Visibility\n\n### Dashboard & Tracking\n- **Dashboard Type**: CLI-based with structured JSON logging\n- **Real-time Updates**: Iteration-by-iteration metrics tracking\n- **Key Metrics Displayed**:\n  - Current Sharpe ratio and champion comparison\n  - Template usage and success rates\n  - Validation pass/fail status\n  - Learning trajectory (convergence, regression detection)\n  - Hall of Fame leaderboard\n\n### Analytics & Reporting\n- **Iteration History**: Complete record of all strategies and metrics\n- **Template Analytics**: Usage statistics and performance trends\n- **Convergence Reports**: Variance monitoring and recommendations\n- **Champion Audit Trail**: Update history with rationales\n- **Rollback History**: Recovery operations log\n\n### Sharing & Export\n- **JSON Exports**: Comprehensive reports for external analysis\n- **Metrics Files**: Prometheus-compatible format for monitoring\n- **Markdown Reports**: Human-readable summaries and recommendations\n- **Code Persistence**: All generated strategies saved for review\n\n## Future Vision\n\n### Short-Term Enhancements (Next 3-6 months)\n- **ðŸ¤– LLM Innovation Activation**: Enable hybrid 20/80 innovation mode â­ **IMMEDIATE PRIORITY**\n  - Phase 1: Dry-run validation (2-3 hours)\n  - Phase 2: Low innovation rate test (5%, 20 generations)\n  - Phase 3: Full activation (20%, 50 generations)\n- **ðŸ”¬ Out-of-Sample Validation**: Extend validation to 2025 data for production readiness\n- **ðŸ“Š Grafana Dashboard**: Web-based monitoring with real-time metrics visualization\n- **ðŸ§ª A/B Testing**: Compare LLM vs Factor Graph innovation effectiveness\n\n### Medium-Term Enhancements (6-12 months)\n- **ðŸŒ Multi-Market Support**: Extend beyond Taiwan market (US, HK, etc.)\n- **ðŸ¤– Multi-LLM Optimization**: Test GPT-5, o3-mini, Grok-4 for generation quality\n- **ðŸ§¬ AST-Based Factor Mutation**: Advanced structural mutations (Tier 3)\n- **ðŸ“¡ Real-Time Data Integration**: Live market data streaming\n\n### Long-Term Vision (12+ months)\n- **ðŸ† Multi-Strategy Portfolio**: Combine multiple champions for diversification\n- **ðŸŒ Community Sharing**: Anonymized factor/template sharing platform\n- **ðŸ”® Predictive Analytics**: Forecast strategy degradation before it happens\n- **ðŸŽ“ Educational Mode**: Tutorial system for learning quantitative trading\n\n### Potential Innovations\n- **Remote Access**: Tunnel features for sharing dashboards with stakeholders\n- **Collaboration**: Multi-user support for team-based strategy development\n- **API Gateway**: RESTful API for external tool integration\n- **Mobile Monitoring**: iOS/Android app for on-the-go tracking\n\n---\n\n**Document Version**: 1.0\n**Last Updated**: 2025-10-25\n**Status**: Draft - Pending Approval\n**Owner**: Personal Project (é€±/æœˆäº¤æ˜“ç³»çµ±)\n",
  "fileStats": {
    "size": 12910,
    "lines": 258,
    "lastModified": "2025-10-28T06:34:10.524Z"
  },
  "comments": []
}