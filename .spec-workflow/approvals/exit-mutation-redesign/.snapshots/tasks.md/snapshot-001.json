{
  "id": "snapshot_1761396012687_ep56n1wqu",
  "approvalId": "approval_1761396012576_b3dgf1w6a",
  "approvalTitle": "Review tasks.md for exit-mutation-redesign (8 tasks, 1-2 days)",
  "version": 1,
  "timestamp": "2025-10-25T12:40:12.687Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: Exit Mutation Redesign\n\n## Phase 1: Core Parameter Mutation (Tasks 1-3)\n\n- [ ] 1. Create ExitParameterMutator module\n  - File: `src/mutation/exit_parameter_mutator.py`\n  - Implement parameter-based mutation (Gaussian noise + bounded ranges)\n  - Define PARAM_BOUNDS for all exit parameters (stop_loss, take_profit, trailing_stop, holding_period)\n  - Implement regex-based parameter value replacement\n  - Validate mutated code with AST parser\n  - Purpose: Replace failed AST manipulation with robust parameter mutation\n  - _Leverage: Existing `ast` module for validation, `random` for Gaussian noise_\n  - _Requirements: 1.1, 1.2, 2.1, 2.2, 3.1, 3.2, 4.1, 4.2, 4.3, 4.4_\n  - _Prompt: Implement the task for spec exit-mutation-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Algorithm Engineer with expertise in genetic algorithms and Python | Task: Create ExitParameterMutator class following requirements 1.1-4.4, implementing Gaussian noise mutation with bounded ranges and regex-based code updates | Restrictions: Must apply Gaussian noise (mean=0, std=0.15), clamp to defined bounds, use regex for safe replacement, validate with ast.parse() | _Leverage: random.gauss() for noise, re module for regex, ast module for validation | _Requirements: Requirements 1.1-1.2 (Parameter mutation), 2.1-2.2 (Bounded ranges), 3.1-3.2 (Gaussian noise), 4.1-4.4 (Regex replacement) | Success: Parameters mutated with Gaussian noise, clamped to bounds correctly, code updated via regex, AST validation passes | Instructions: Set task to [-] in tasks.md, mark [x] when ExitParameterMutator tests pass with >70% success rate_\n\n- [ ] 2. Define parameter bounds configuration\n  - File: `config/mutation_config.yaml`\n  - Define bounds for all 4 parameters:\n    - stop_loss_pct: [0.01, 0.20]\n    - take_profit_pct: [0.05, 0.50]\n    - trailing_stop_offset: [0.005, 0.05]\n    - holding_period_days: [1, 60]\n  - Add Gaussian std_dev configuration (default 0.15)\n  - Document parameter meanings and ranges\n  - Purpose: Centralized mutation parameter configuration\n  - _Leverage: Existing config structure from `config/learning_system.yaml`_\n  - _Requirements: 2.1, 2.2, 2.3, 2.4_\n  - _Prompt: Implement the task for spec exit-mutation-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: DevOps Engineer with expertise in YAML configuration and financial domain knowledge | Task: Create mutation_config.yaml with exit parameter bounds following requirements 2.1-2.4, providing sensible defaults based on trading best practices | Restrictions: Must document ranges with financial rationale, use realistic bounds (not too tight/loose), follow existing YAML structure | _Leverage: config/learning_system.yaml for structure | _Requirements: Requirements 2.1-2.4 (Parameter bounds) | Success: Config defines all 4 parameter bounds with clear documentation, values are financially realistic | Instructions: Set task to [-], mark [x] when config validates and loads_\n\n- [ ] 3. Integrate ExitParameterMutator into Factor Graph\n  - File: `src/mutation/factor_graph.py` or `src/mutation/unified_mutation_operator.py` (modify)\n  - Add \"exit_param\" to mutation type selection with 20% weight\n  - Implement exit mutation path in mutation operator\n  - Track exit mutation success/failure in metadata\n  - Purpose: Enable exit parameter optimization in evolution loop\n  - _Leverage: Existing mutation operator structure, ExitParameterMutator module_\n  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_\n  - _Prompt: Implement the task for spec exit-mutation-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in genetic algorithms and system integration | Task: Integrate ExitParameterMutator into existing mutation system following requirements 5.1-5.5, adding exit_param as 20% weighted mutation type | Restrictions: Must maintain backward compatibility with existing mutations, handle missing exit parameters gracefully, log all mutations | _Leverage: src/mutation/factor_graph.py or unified_mutation_operator.py, ExitParameterMutator | _Requirements: Requirements 5.1-5.5 (Integration with mutation system) | Success: Exit mutation selectable with 20% weight, metadata tracked correctly, existing mutations unaffected | Instructions: Set task to [-], mark [x] when integration tests pass_\n\n## Phase 2: Testing (Tasks 4-6)\n\n- [ ] 4. Write ExitParameterMutator unit tests\n  - File: `tests/mutation/test_exit_parameter_mutator.py`\n  - Test Gaussian noise distribution (68% within ±15%, 95% within ±30%)\n  - Test boundary clamping for all 4 parameters\n  - Test regex replacement patterns for each parameter\n  - Test AST validation after mutation\n  - Test skipping when parameter not found in code\n  - Coverage target: >90%\n  - _Leverage: `pytest`, statistical tests for Gaussian distribution_\n  - _Requirements: 1.1, 1.2, 2.1, 2.2, 3.1, 3.2, 4.1, 4.2, 4.3, 4.4_\n  - _Prompt: Implement the task for spec exit-mutation-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in statistical testing and mutation algorithms | Task: Create comprehensive unit tests for ExitParameterMutator following all requirements, testing Gaussian distribution, clamping, regex replacement, and validation | Restrictions: Must statistically verify Gaussian distribution over 1000 samples, test all boundary conditions, achieve >90% coverage | _Leverage: pytest, statistical analysis (chi-square test for distribution) | _Requirements: All requirements 1.1-4.4 | Success: All mutation aspects tested, Gaussian distribution verified, boundary cases covered, >90% coverage | Instructions: Set task to [-], mark [x] when tests pass with >90% coverage_\n\n- [ ] 5. Write integration tests with real strategy code\n  - File: `tests/integration/test_exit_mutation_integration.py`\n  - Test 1: Mutate strategy with all 4 exit parameters, verify success\n  - Test 2: Mutate strategy with only stop_loss, verify success\n  - Test 3: Mutate strategy without exit parameters, verify graceful skip\n  - Test 4: Run 100 mutations, verify success rate >70% (vs 0% baseline)\n  - _Leverage: Real strategy code from champions or templates_\n  - _Requirements: All, with success rate >70% target_\n  - _Prompt: Implement the task for spec exit-mutation-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Integration Test Engineer with expertise in end-to-end testing and success rate validation | Task: Create integration tests with real strategy code, validating >70% success rate improvement over current 0% rate | Restrictions: Must test with realistic strategy code, run sufficient iterations (100) for statistical confidence, handle all edge cases | _Leverage: Real champion strategies or templates | _Requirements: All requirements with >70% success rate goal | Success: Integration tests pass, >70% success rate achieved on real code, edge cases handled | Instructions: Set task to [-], mark [x] when success rate >70% validated_\n\n- [ ] 6. Write performance benchmark tests\n  - File: `tests/performance/test_exit_mutation_performance.py`\n  - Measure mutation latency (<100ms per mutation target)\n  - Measure regex matching performance (<10ms per parameter)\n  - Compare performance vs old AST-based approach\n  - _Leverage: `pytest-benchmark` or timing utilities_\n  - _Requirements: Performance requirements_\n  - _Prompt: Implement the task for spec exit-mutation-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Performance Engineer with expertise in benchmarking and profiling | Task: Create performance tests validating mutation latency requirements, comparing new approach vs old AST method | Restrictions: Must use consistent benchmarking methodology, run multiple iterations for accuracy, document performance improvement | _Leverage: pytest-benchmark or time.perf_counter() | _Requirements: Performance requirement (mutation <100ms, regex <10ms) | Success: Benchmarks show mutation within targets, significantly faster than AST approach | Instructions: Set task to [-], mark [x] when benchmarks meet performance targets_\n\n## Phase 3: Documentation & Monitoring (Tasks 7-8)\n\n- [ ] 7. Create user documentation\n  - File: `docs/EXIT_MUTATION.md`\n  - Document parameter-based mutation approach vs old AST method\n  - Document parameter bounds and their financial rationale\n  - Document configuration options in mutation_config.yaml\n  - Provide troubleshooting guide (parameter not found, invalid bounds)\n  - _Leverage: Existing documentation structure_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec exit-mutation-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer with expertise in algorithm documentation and financial trading | Task: Create comprehensive exit mutation documentation covering approach, configuration, and troubleshooting | Restrictions: Must explain financial rationale for bounds, compare to old AST approach, maintain consistent structure | _Leverage: Existing documentation structure and style | _Requirements: All requirements (complete understanding of new approach) | Success: Documentation is complete, clear, explains rationale, users understand new mutation method | Instructions: Set task to [-], mark [x] when documentation review passes_\n\n- [ ] 8. Add exit mutation metrics tracking\n  - File: `src/mutation/factor_graph.py` or metrics module (modify)\n  - Track exit_mutations_total counter\n  - Track exit_mutation_success_rate gauge\n  - Log exit mutation metadata (parameter, old/new values) to JSON\n  - Purpose: Monitor exit mutation performance in production\n  - _Leverage: Existing metrics infrastructure from `src/monitoring/metrics_collector.py`_\n  - _Requirements: 5.4, 5.5_\n  - _Prompt: Implement the task for spec exit-mutation-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: SRE with expertise in Prometheus instrumentation and mutation tracking | Task: Add exit mutation metrics following requirements 5.4-5.5, tracking total mutations, success rate, and metadata in JSON logs | Restrictions: Must integrate with existing metrics system, export to Prometheus, log structured metadata to JSON | _Leverage: src/monitoring/metrics_collector.py, JSON logging utilities | _Requirements: Requirements 5.4-5.5 (Metrics tracking and logging) | Success: Exit mutations tracked in Prometheus, success rate calculated, metadata logged to JSON | Instructions: Set task to [-], mark [x] when metrics visible in Prometheus_\n\n## Summary\n\n**Total Tasks**: 8\n**Estimated Time**: 1-2 days (full-time)\n\n**Phase Breakdown**:\n- Phase 1 (Core Mutation): Tasks 1-3 → 4-6 hours\n- Phase 2 (Testing): Tasks 4-6 → 4-6 hours\n- Phase 3 (Docs/Metrics): Tasks 7-8 → 2-3 hours\n\n**Dependencies**:\n- Task 1 is the core implementation (must complete first)\n- Task 2 can run in parallel with Task 1\n- Task 3 depends on Task 1 (needs ExitParameterMutator)\n- Tasks 4-6 depend on Task 1 complete\n- Task 7 can start after Task 1 (document approach)\n- Task 8 depends on Task 3 (integrate metrics with mutation system)\n\n**Critical Path**: 1→3→5→8\n\n**Success Metrics**:\n- Primary: Success rate improves from 0% to >70%\n- Performance: Mutation latency <100ms\n- Reliability: Graceful handling of missing parameters\n- Observability: Metrics and logs track all mutations\n",
  "fileStats": {
    "size": 11573,
    "lines": 120,
    "lastModified": "2025-10-25T00:25:50.332Z"
  },
  "comments": []
}