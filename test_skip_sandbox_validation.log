2025-10-09 23:33:21,836 - __main__ - INFO - Pre-loading Finlab datasets to avoid repeated imports in sandbox...
2025-10-09 23:33:21,838 - __main__ - INFO - Logged into Finlab 1.5.3
2025-10-09 23:33:31,985 - __main__ - INFO - Finlab datasets pre-loaded successfully: 9 datasets
2025-10-09 23:33:31,985 - __main__ - INFO - Generating strategy for iteration 0
2025-10-09 23:33:32,121 - claude_api_client - INFO - Initialized Claude API client: model=anthropic/claude-sonnet-4, temp=0.7
2025-10-09 23:33:32,121 - __main__ - INFO - Initialized Claude API client: model=anthropic/claude-sonnet-4
2025-10-09 23:33:32,121 - __main__ - INFO - API call attempt 1/3
2025-10-09 23:33:32,121 - claude_api_client - INFO - Generating strategy for iteration 0
2025-10-09 23:33:32,311 - claude_api_client - INFO - API call attempt 1/3
2025-10-09 23:33:35,650 - httpx - INFO - HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-09 23:33:39,704 - claude_api_client - INFO - API call successful: 863 chars
2025-10-09 23:33:39,704 - claude_api_client - INFO - Successfully generated strategy code (849 chars)
2025-10-09 23:33:39,705 - __main__ - INFO - Strategy generation successful: 849 chars
2025-10-09 23:33:39,705 - __main__ - WARNING - Generated code missing 'position' variable
2025-10-09 23:33:39,705 - __main__ - WARNING - Generated code missing 'sim()' call
2025-10-09 23:33:39,712 - __main__ - INFO - [Iteration 0] Validating generated code with AST...
2025-10-09 23:33:39,713 - __main__ - INFO - [Iteration 0] ‚úÖ Code validation passed
2025-10-09 23:33:39,713 - __main__ - INFO - [Iteration 0] Skipping sandbox validation - proceeding to main process execution
2025-10-09 23:33:39,713 - __main__ - INFO - [Iteration 0] Executing backtest in main process...
<string>:7: FutureWarning: The default fill_method='pad' in FinlabDataFrame.pct_change is deprecated and will be removed in a future version. Either fill in any non-leading NA values prior to calling pct_change or specify 'fill_method=None' to not fill NA values.
<string>:14: FutureWarning: The default fill_method='pad' in FinlabDataFrame.pct_change is deprecated and will be removed in a future version. Either fill in any non-leading NA values prior to calling pct_change or specify 'fill_method=None' to not fill NA values.
2025-10-09 23:33:53,422 - __main__ - INFO - [Iteration 0] Signal generated successfully: shape=(4544, 2648)
2025-10-09 23:33:53,422 - __main__ - INFO - [Iteration 0] ‚úÖ Main process execution successful
2025-10-09 23:33:53,422 - __main__ - INFO - [Iteration 0] Extracting metrics from signal...
2025-10-09 23:33:53,440 - metrics_extractor - INFO - Running backtest with resample='D', stop_loss=0.1
2025-10-09 23:34:07,585 - metrics_extractor - WARNING - get_stats() method failed: float() argument must be a string or a real number, not 'dict'
2025-10-09 23:34:07,585 - metrics_extractor - INFO - Backtest successful: 9 metrics extracted
2025-10-09 23:34:07,585 - __main__ - INFO - [Iteration 0] ‚úÖ Metrics extraction successful
2025-10-09 23:34:07,619 - __main__ - INFO - Saved iteration 0 to iteration_history.jsonl
2025-10-09 23:34:07,619 - __main__ - INFO - Generating strategy for iteration 1
2025-10-09 23:34:07,666 - claude_api_client - INFO - Initialized Claude API client: model=anthropic/claude-sonnet-4, temp=0.7
2025-10-09 23:34:07,666 - __main__ - INFO - Initialized Claude API client: model=anthropic/claude-sonnet-4
2025-10-09 23:34:07,666 - __main__ - INFO - API call attempt 1/3
2025-10-09 23:34:07,666 - claude_api_client - INFO - Generating strategy for iteration 1
2025-10-09 23:34:07,677 - claude_api_client - INFO - API call attempt 1/3
2025-10-09 23:34:09,832 - httpx - INFO - HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-09 23:34:16,956 - claude_api_client - INFO - API call successful: 1131 chars
2025-10-09 23:34:16,956 - claude_api_client - INFO - Successfully generated strategy code (1117 chars)
2025-10-09 23:34:16,957 - __main__ - INFO - Strategy generation successful: 1117 chars
2025-10-09 23:34:16,957 - __main__ - WARNING - Generated code missing 'position' variable
2025-10-09 23:34:16,957 - __main__ - WARNING - Generated code missing 'sim()' call
2025-10-09 23:34:16,966 - __main__ - INFO - [Iteration 1] Validating generated code with AST...
2025-10-09 23:34:16,968 - __main__ - INFO - [Iteration 1] ‚úÖ Code validation passed
2025-10-09 23:34:16,968 - __main__ - INFO - [Iteration 1] Skipping sandbox validation - proceeding to main process execution
2025-10-09 23:34:16,968 - __main__ - INFO - [Iteration 1] Executing backtest in main process...
2025-10-09 23:34:43,194 - __main__ - INFO - [Iteration 1] Signal generated successfully: shape=(4544, 2648)
2025-10-09 23:34:43,194 - __main__ - INFO - [Iteration 1] ‚úÖ Main process execution successful
2025-10-09 23:34:43,194 - __main__ - INFO - [Iteration 1] Extracting metrics from signal...
2025-10-09 23:34:43,206 - metrics_extractor - INFO - Running backtest with resample='D', stop_loss=0.1
2025-10-09 23:34:53,588 - metrics_extractor - WARNING - get_stats() method failed: float() argument must be a string or a real number, not 'dict'
2025-10-09 23:34:53,588 - metrics_extractor - INFO - Backtest successful: 9 metrics extracted
2025-10-09 23:34:53,588 - __main__ - INFO - [Iteration 1] ‚úÖ Metrics extraction successful
2025-10-09 23:34:53,616 - __main__ - INFO - Saved iteration 1 to iteration_history.jsonl
2025-10-09 23:34:53,616 - __main__ - INFO - Generating strategy for iteration 2
2025-10-09 23:34:53,676 - claude_api_client - INFO - Initialized Claude API client: model=anthropic/claude-sonnet-4, temp=0.7
2025-10-09 23:34:53,677 - __main__ - INFO - Initialized Claude API client: model=anthropic/claude-sonnet-4
2025-10-09 23:34:53,677 - __main__ - INFO - API call attempt 1/3
2025-10-09 23:34:53,677 - claude_api_client - INFO - Generating strategy for iteration 2
2025-10-09 23:34:53,685 - claude_api_client - INFO - API call attempt 1/3
2025-10-09 23:34:55,911 - httpx - INFO - HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-09 23:35:04,566 - claude_api_client - INFO - API call successful: 1428 chars
2025-10-09 23:35:04,566 - claude_api_client - INFO - Successfully generated strategy code (1414 chars)
2025-10-09 23:35:04,566 - __main__ - INFO - Strategy generation successful: 1414 chars
2025-10-09 23:35:04,566 - __main__ - WARNING - Generated code missing 'position' variable
2025-10-09 23:35:04,566 - __main__ - WARNING - Generated code missing 'sim()' call
2025-10-09 23:35:04,575 - __main__ - INFO - [Iteration 2] Validating generated code with AST...
2025-10-09 23:35:04,576 - __main__ - INFO - [Iteration 2] ‚úÖ Code validation passed
2025-10-09 23:35:04,576 - __main__ - INFO - [Iteration 2] Skipping sandbox validation - proceeding to main process execution
2025-10-09 23:35:04,576 - __main__ - INFO - [Iteration 2] Executing backtest in main process...
<string>:14: FutureWarning: The default fill_method='pad' in FinlabDataFrame.pct_change is deprecated and will be removed in a future version. Either fill in any non-leading NA values prior to calling pct_change or specify 'fill_method=None' to not fill NA values.
<string>:15: FutureWarning: The default fill_method='pad' in FinlabDataFrame.pct_change is deprecated and will be removed in a future version. Either fill in any non-leading NA values prior to calling pct_change or specify 'fill_method=None' to not fill NA values.
2025-10-09 23:35:24,127 - __main__ - INFO - [Iteration 2] Signal generated successfully: shape=(4544, 2648)
2025-10-09 23:35:24,127 - __main__ - INFO - [Iteration 2] ‚úÖ Main process execution successful
2025-10-09 23:35:24,127 - __main__ - INFO - [Iteration 2] Extracting metrics from signal...
2025-10-09 23:35:24,141 - metrics_extractor - INFO - Running backtest with resample='D', stop_loss=0.1
2025-10-09 23:35:36,025 - metrics_extractor - WARNING - get_stats() method failed: float() argument must be a string or a real number, not 'dict'
2025-10-09 23:35:36,026 - metrics_extractor - INFO - Backtest successful: 9 metrics extracted
2025-10-09 23:35:36,026 - __main__ - INFO - [Iteration 2] ‚úÖ Metrics extraction successful
2025-10-09 23:35:36,219 - __main__ - INFO - Saved iteration 2 to iteration_history.jsonl
======================================================================
üöÄ Autonomous Iteration Engine - Starting
======================================================================
Configuration:
  - Total Iterations: 3
  - Start Iteration: 0
  - History File: iteration_history.jsonl
  - Best Strategy File: best_strategy.py
======================================================================

‚è≥ Pre-loading Finlab datasets (this may take 10+ minutes)...
Ëº∏ÂÖ•ÊàêÂäü!
   Loading datasets from Finlab API...
   Loading price data...
   Loading fundamental data...
   Loading valuation data...
   Loading revenue data...
   Loading financial statement data...
   Loading institutional investor data...
   ‚úÖ Loaded 9 datasets
‚úÖ Finlab datasets loaded successfully (9 datasets)


==========================================
Iteration 1/3
==========================================
Generating strategy...
  ‚úì Strategy saved to generated_strategy_iter0.py
Validating code...
  ‚úì Validation passed
Executing backtest...
  ‚úì Backtest complete

üìà Results:
  Sharpe Ratio:    0.0000
  Total Return:    0.00%
  Max Drawdown:    0.00%
  Win Rate:        0.00%
üèÜ Saved new best strategy from iteration 0
  üèÜ New best strategy!
  ‚úì Results saved to iteration_history.jsonl

==========================================
Iteration 2/3
==========================================
üìä Fallback Status: 0/1 total (0.0%), 0/10 recent

Generating strategy...
  ‚úì Strategy saved to generated_strategy_iter1.py
Validating code...
  ‚úì Validation passed
Executing backtest...
  ‚úì Backtest complete

üìà Results:
  Sharpe Ratio:    0.0000
  Total Return:    0.00%
  Max Drawdown:    0.00%
  Win Rate:        0.00%
  ‚úì Results saved to iteration_history.jsonl

==========================================
Iteration 3/3
==========================================
üìä Fallback Status: 0/2 total (0.0%), 0/10 recent

Generating strategy...
  ‚úì Strategy saved to generated_strategy_iter2.py
Validating code...
  ‚úì Validation passed
Executing backtest...
  ‚úì Backtest complete

üìà Results:
  Sharpe Ratio:    0.0000
  Total Return:    0.00%
  Max Drawdown:    0.00%
  Win Rate:        0.00%
  ‚úì Results saved to iteration_history.jsonl


======================================================================
üèÅ Iteration Engine Complete
======================================================================

üèÜ Best Strategy:
  - Iteration: 1
  - Sharpe Ratio: 0.0000
  - Total Return: 0.00%
  - Saved to: best_strategy.py

üìä Fallback Statistics:
  - Total Fallbacks: 0/3 (0.0%)
  - Threshold: 30.0%
  - Template: Iteration 6 (Sharpe: 2.4751)

üìä Full history available in: iteration_history.jsonl

