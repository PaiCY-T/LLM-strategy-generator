Testing autonomous loop...

Note: Running without real finlab data - execution will fail
      This tests the loop mechanism, not actual strategy performance


============================================================
AUTONOMOUS LEARNING LOOP - START
============================================================
Model: gemini-2.5-flash
Max iterations: 3
Sandbox mode: ENABLED


============================================================
ITERATION 0
============================================================


[0.5/6] Capturing configuration snapshot...
âœ… Configuration captured
[1/6] Building prompt...
âœ… Prompt ready (7937 chars)

[2/6] Generating strategy with gemini-2.5-flash...
   â†’ Using Factor Graph mutation (default)
ğŸ¯ Attempting Google AI (primary)...
Calling Google AI with gemini-2.5-flash (attempt 1/3)...
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1761819206.478614   14114 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
ğŸ“ Response preview: # 1. Load data
close = data.get('price:æ”¶ç›¤åƒ¹')
trading_value = data.get('price:æˆäº¤é‡‘é¡')
roe = data.get('fundamental_features:ROEç¨…å¾Œ')
revenue_yoy = data.get('monthly_revenue:å»å¹´åŒæœˆå¢æ¸›(%)')
foreign_net_buy = data.get('institutional_investors_trading_summary:å¤–é™¸è³‡è²·è³£è¶…è‚¡æ•¸(ä¸å«å¤–è³‡è‡ªç‡Ÿå•†)')
rsi = data.indicator('RSI')

# 2. Calculate factors
# Factor 1: Long-term Price Momentum (60-day returns)
momentum = close.pct_change(60).shift(1)

# Factor 2: Quality (ROE with 4-quarter smoothing)
# ROE is quarterly, so ffill the...
   âœ“ Detected raw Python code (Strategy 3): 38/41 lines are Python
âœ… Successfully generated strategy (1916 chars)
âœ… Strategy generated (1916 chars)

[2.5/6] Auto-fixing dataset keys...
   Code hash: 7b29ef5e48b4791d
âœ… No fixes needed

[2.7/6] Static validation...
âœ… Static validation passed

[3/6] Validating code...
âœ… Validation passed

[4/6] Executing strategy (mode: sandbox)...
âŒ Execution failed
   Error: Container exited with code 1:
Traceback (most recent call last):
  File "/code/strategy.py", line 31...

[5/6] Building feedback...
âœ… Feedback generated (395 chars)

[6/6] Recording iteration...
âœ… Iteration recorded
âœ… Code saved to generated_strategy_loop_iter0.py

============================================================
ITERATION 1
============================================================


[0.5/6] Capturing configuration snapshot...
Configuration capture failed: No module named 'src.config.experiment_config'
âš ï¸  Configuration capture failed (continuing)
[1/6] Building prompt...
âœ… Prompt ready (8341 chars)

[2/6] Generating strategy with gemini-2.5-flash...
   â†’ Using Factor Graph mutation (default)
ğŸ¯ Attempting Google AI (primary)...
Calling Google AI with gemini-2.5-flash (attempt 1/3)...
E0000 00:00:1761819223.446837   14114 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
ğŸ“ Response preview: # 1. Load data
close = data.get('price:æ”¶ç›¤åƒ¹')
trading_value = data.get('price:æˆäº¤é‡‘é¡')
roe = data.get('fundamental_features:ROEç¨…å¾Œ')
pe_ratio = data.get('price_earning_ratio:æœ¬ç›Šæ¯”')
revenue_yoy = data.get('monthly_revenue:å»å¹´åŒæœˆå¢æ¸›(%)')
foreign_net_buy = data.get('institutional_investors_trading_summary:å¤–é™¸è³‡è²·è³£è¶…è‚¡æ•¸(ä¸å«å¤–è³‡è‡ªç‡Ÿå•†)')
rsi = data.indicator('RSI')

# 2. Calculate factors
# Factor 1: Long-term Price Momentum (60-day returns)
momentum_factor = close.pct_change(60).shift(1)

# Factor 2: Quality (ROE with...
   âœ“ Detected raw Python code (Strategy 3): 45/49 lines are Python
âœ… Successfully generated strategy (2367 chars)
âœ… Strategy generated (2367 chars)

[2.5/6] Auto-fixing dataset keys...
   Code hash: 406b96a4ee6ecd1d
âœ… No fixes needed

[2.7/6] Static validation...
âœ… Static validation passed

[3/6] Validating code...
âœ… Validation passed

[4/6] Executing strategy (mode: sandbox)...
âŒ Execution failed
   Error: Container exited with code 1:
Traceback (most recent call last):
  File "/code/strategy.py", line 31...

[5/6] Building feedback...
âœ… Feedback generated (395 chars)

[6/6] Recording iteration...
âœ… Iteration recorded
âœ… Code saved to generated_strategy_loop_iter1.py

============================================================
ITERATION 2
============================================================


[0.5/6] Capturing configuration snapshot...
Configuration capture failed: No module named 'src.config.experiment_config'
âš ï¸  Configuration capture failed (continuing)
[1/6] Building prompt...
âœ… Prompt ready (8341 chars)

[2/6] Generating strategy with gemini-2.5-flash...
   â†’ Using Factor Graph mutation (default)
ğŸ¯ Attempting Google AI (primary)...
Calling Google AI with gemini-2.5-flash (attempt 1/3)...
E0000 00:00:1761819242.225359   14114 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
ğŸ“ Response preview: # 1. Load data
close = data.get('price:æ”¶ç›¤åƒ¹')
trading_value = data.get('price:æˆäº¤é‡‘é¡')
roe = data.get('fundamental_features:ROEç¨…å¾Œ')
revenue_yoy = data.get('monthly_revenue:å»å¹´åŒæœˆå¢æ¸›(%)')
foreign_net_buy = data.get('institutional_investors_trading_summary:å¤–é™¸è³‡è²·è³£è¶…è‚¡æ•¸(ä¸å«å¤–è³‡è‡ªç‡Ÿå•†)')
rsi = data.indicator('RSI')

# 2. Calculate factors
# Factor 1: Price Momentum (60-day returns)
momentum = close.pct_change(60).shift(1)

# Factor 2: Quality & Growth (Smoothed ROE and Monthly Revenue YoY)
# Smooth ROE over 4 quart...
   âœ“ Detected raw Python code (Strategy 3): 38/40 lines are Python
âœ… Successfully generated strategy (1838 chars)
âœ… Strategy generated (1838 chars)

[2.5/6] Auto-fixing dataset keys...
   Code hash: 9ffa05de46582b3f
âœ… No fixes needed

[2.7/6] Static validation...
âœ… Static validation passed

[3/6] Validating code...
âœ… Validation passed

[4/6] Executing strategy (mode: sandbox)...
Failed to check container 4416c38a3749f5a1119fff83a7d22075fc0342d9ffc4affa42e200a44bddded4: Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/home/john/.local/lib/python3.10/site-packages/requests/models.py", line 976, in json
    return complexjson.loads(self.text, **kwargs)
  File "/usr/lib/python3.10/json/__init__.py", line 346, in loads
    return _default_decoder.decode(s)
  File "/usr/lib/python3.10/json/decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File "/usr/lib/python3.10/json/decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/mnt/c/Users/jnpi/documents/finlab/src/sandbox/runtime_monitor.py", line 294, in _check_all_containers
    self._check_container(container_id)
  File "/mnt/c/Users/jnpi/documents/finlab/src/sandbox/runtime_monitor.py", line 311, in _check_container
    stats = self.container_monitor.get_container_stats(container_id)
  File "/mnt/c/Users/jnpi/documents/finlab/src/sandbox/container_monitor.py", line 171, in get_container_stats
    return self._collect_stats(container)
  File "/mnt/c/Users/jnpi/documents/finlab/src/sandbox/container_monitor.py", line 233, in _collect_stats
    stats_data = container.stats(stream=False)
  File "/home/john/.local/lib/python3.10/site-packages/docker/models/containers.py", line 438, in stats
    return self.client.api.stats(self.id, **kwargs)
  File "/home/john/.local/lib/python3.10/site-packages/docker/utils/decorators.py", line 19, in wrapped
    return f(self, resource_id, *args, **kwargs)
  File "/home/john/.local/lib/python3.10/site-packages/docker/api/container.py", line 1184, in stats
    return self._result(self._get(url, params=params), json=True)
  File "/home/john/.local/lib/python3.10/site-packages/docker/api/client.py", line 284, in _result
    return response.json()
  File "/home/john/.local/lib/python3.10/site-packages/requests/models.py", line 980, in json
    raise RequestsJSONDecodeError(e.msg, e.doc, e.pos)
requests.exceptions.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
âŒ Execution failed
   Error: Container exited with code 1:
Traceback (most recent call last):
  File "/code/strategy.py", line 31...

[5/6] Building feedback...
âœ… Feedback generated (395 chars)

[6/6] Recording iteration...
âœ… Iteration recorded
âœ… Code saved to generated_strategy_loop_iter2.py

============================================================
AUTONOMOUS LEARNING LOOP - COMPLETE
============================================================
Total time: 51.9s
Total iterations: 3
âœ… Successful: 0
âŒ Failed: 3
   - Validation failures: 0
   - Execution failures: 3

Success rate: 0.0%

============================================================
LLM INNOVATION STATISTICS
============================================================
LLM enabled: True
Innovation rate: 5.0%
LLM innovations: 0
LLM fallbacks: 0
Factor Graph mutations: 3
LLM success rate: 0.0%

LLM Costs:
  Total cost: $0.000000
  Total tokens: 0
  Successful generations: 0

============================================================
TEST RESULTS
============================================================
Loop completed: 3 iterations
Time per iteration: 17.3s

âœ… Autonomous loop mechanism verified
