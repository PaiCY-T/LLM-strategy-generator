{
  "case": "medium",
  "run": 1,
  "complexity": "medium",
  "strategy_code": "close = data.get('price:\u6536\u76e4\u50f9')\nvol = data.get('price:\u6210\u4ea4\u80a1\u6578')\nhigh = data.get('price:\u6700\u9ad8\u50f9')\nlow = data.get('price:\u6700\u4f4e\u50f9')\nopen_price = data.get('price:\u958b\u76e4\u50f9')\n\nroe = data.get('fundamental_features:ROE\u7a05\u5f8c').shift(1)\neps = data.get('fundamental_features:\u6bcf\u80a1\u7a05\u5f8c\u6de8\u5229').shift(1)\nmargin = data.get('fundamental_features:\u71df\u696d\u5229\u76ca\u7387').shift(1)\ndebt = data.get('fundamental_features:\u8ca0\u50b5\u6bd4\u7387').shift(1)\n\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4').shift(1)\npe = data.get('price_earning_ratio:\u672c\u76ca\u6bd4').shift(1)\n\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536').shift(1)\nrev_yoy = data.get('monthly_revenue:\u53bb\u5e74\u540c\u6708\u589e\u6e1b(%)').shift(1)\n\n# === STEP 2: Calculate Indicators ===\n\n# Quality Factor: High ROE, Low Debt\nquality_score = roe.rank(pct=True) - debt.rank(pct=True)\n\n# Growth Factor: High Revenue YoY growth and positive EPS\ngrowth_score = rev_yoy.rank(pct=True) + eps.rank(pct=True)\n\n# Momentum Factor: Price change over 20 days\nprice_change_20d = (close - close.shift(20)) / close.shift(20)\nmomentum_score = price_change_20d.rank(pct=True)\n\n# Value Factor: Low P/E and P/B\nvalue_score = (1 - pe.rank(pct=True)) + (1 - pb.rank(pct=True))\n\n# Liquidity Filter: Average daily volume over 5 days (in shares)\navg_vol_5d = vol.average(5)\n\n# === STEP 3: Define Conditions ===\n\n# Condition 1: Fundamental Quality and Growth\n# ROE > 10%, Debt Ratio < 60%, Monthly Revenue YoY Growth > 0%\ncond_quality_growth = (roe > 10) & (debt < 60) & (rev_yoy > 0)\n\n# Condition 2: Momentum - Price above 20-day Simple Moving Average (SMA)\nsma20 = close.average(20)\ncond_momentum = (close > sma20) & (price_change_20d > 0.01) # At least 1% price increase\n\n# Condition 3: Value - P/E between 5 and 25, P/B between 0.8 and 3\ncond_value = (pe > 5) & (pe < 25) & (pb > 0.8) & (pb < 3)\n\n# Condition 4: Liquidity Filter - Average daily volume > 50000 shares\ncond_liquidity = (avg_vol_5d >= 50 * 1000)\n\n# Combine all conditions with AND logic\ncombined_conditions = cond_quality_growth & cond_momentum & cond_value & cond_liquidity\n\n# === STEP 4: Combine & Select ===\n# Create a composite score by weighting the individual factor scores\n# Quality, Growth, Momentum, Value\ncomposite_score = quality_score * 0.3 + growth_score * 0.3 + momentum_score * 0.2 + value_score * 0.2\n\n# Apply the combined conditions and then select the top 10 stocks based on the composite score\nposition = combined_conditions.where(composite_score == composite_score.where(combined_conditions).rank(pct=True).is_largest(10).astype(float))\nposition = position.fillna(False) # Fill NaN values (where conditions are not met) with False\n\n# === STEP 5: Filter & Backtest (FIXED - copy exactly) ===\nposition = position.loc[start_date:end_date]\nreport = sim(position, fee_ratio=fee_ratio, tax_ratio=tax_ratio, resample=\"M\")",
  "execution_result": {
    "success": false,
    "sharpe_ratio": null,
    "error_type": "ValidationError",
    "error_message": "Metric validation failed: sharpe_ratio must be a valid number, got NaN",
    "metrics": {}
  },
  "timestamp": "2025-11-21T12:58:06.058442"
}