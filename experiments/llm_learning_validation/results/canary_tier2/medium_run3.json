{
  "case": "medium",
  "run": 3,
  "complexity": "medium",
  "strategy_code": "# === STEP 1: Load Data (MUST use exact field names from APPENDIX) ===\nclose = data.get('price:\u6536\u76e4\u50f9')\nvol = data.get('price:\u6210\u4ea4\u80a1\u6578')\nhigh = data.get('price:\u6700\u9ad8\u50f9')\nlow = data.get('price:\u6700\u4f4e\u50f9')\nopen_price = data.get('price:\u958b\u76e4\u50f9')\n\n# Fundamentals & Valuation (shifted to prevent look-ahead)\nroe = data.get('fundamental_features:ROE\u7a05\u5f8c').shift(1)\neps = data.get('fundamental_features:\u6bcf\u80a1\u7a05\u5f8c\u6de8\u5229').shift(1)\nmargin = data.get('fundamental_features:\u71df\u696d\u5229\u76ca\u7387').shift(1)\ndebt = data.get('fundamental_features:\u8ca0\u50b5\u6bd4\u7387').shift(1)\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4').shift(1)\npe = data.get('price_earning_ratio:\u672c\u76ca\u6bd4').shift(1)\n\n# Monthly Revenue (shifted to prevent look-ahead)\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536').shift(1)\nrev_yoy = data.get('monthly_revenue:\u53bb\u5e74\u540c\u6708\u589e\u6e1b(%)').shift(1)\n\n# === STEP 2: Calculate Indicators ===\n\n# Momentum: 30-day price change percentage\nprice_change_30d = (close - close.shift(30)) / close.shift(30)\n\n# Value: Inverse of P/B ratio (higher is better)\n# Handle potential division by zero or negative PB\ninverse_pb = 1 / pb.where(pb > 0, 0.0001) # Avoid 0 or negative PB\n\n# Quality: Average ROE over last 4 quarters (annualized)\n# Assuming ROE is quarterly; average 4 quarters for a smoother, annual view\nroe_avg_4q = roe.rolling(window=4, min_periods=1).mean()\n\n# Growth: Average Revenue YoY over last 3 months\nrev_yoy_avg_3m = rev_yoy.rolling(window=3, min_periods=1).mean()\n\n# Liquidity: Average daily volume over 5 days\navg_vol_5d = vol.average(5)\n\n# === STEP 3: Define Conditions ===\n\n# Condition 1: Quality - Strong and consistent ROE\n# ROE must be positive and above a certain threshold, and also above its recent average\ncond_roe_strong = (roe_avg_4q > 12) & (roe > 0) # ROE > 12% and positive\n\n# Condition 2: Growth - Positive and accelerating revenue growth\n# Revenue YoY must be positive and show some acceleration (e.g., above 5%)\ncond_rev_growth = (rev_yoy_avg_3m > 5)\n\n# Condition 3: Momentum - Positive short-term price momentum\n# Price change over 30 days must be positive and above a minimum threshold\ncond_momentum = (price_change_30d > 0.03) # Price increased by at least 3% in 30 days\n\n# Condition 4: Value - Reasonable valuation (not too expensive)\n# P/B ratio should be below a certain limit, but not negative\ncond_pb_value = (pb < 3) & (pb > 0) # P/B less than 3, and positive\n\n# Condition 5: Liquidity - Sufficient trading volume\n# Average daily volume must be at least 1000 shares (adjust based on market)\ncond_liquidity = (avg_vol_5d >= 1000 * 1000) # Volume in shares, 1 million shares\n\n# Condition 6: Price above 20-day Simple Moving Average (SMA)\nsma20 = close.average(20)\ncond_price_above_sma = (close > sma20)\n\n# === STEP 4: Combine & Select ===\n\n# Combine all conditions. A stock must satisfy all conditions to be considered.\ncombined_conditions = cond_roe_strong & cond_rev_growth & cond_momentum & \\\n                      cond_pb_value & cond_liquidity & cond_price_above_sma\n\n# Select the top 10 stocks that meet all combined conditions.\n# If fewer than 10 stocks meet the criteria, select all that do.\nposition = combined_conditions.is_largest(10)\n\n# === STEP 5: Filter & Backtest (FIXED - copy exactly) ===\nposition = position.loc[start_date:end_date]\nreport = sim(position, fee_ratio=fee_ratio, tax_ratio=tax_ratio, resample=\"M\")",
  "execution_result": {
    "success": true,
    "sharpe_ratio": 0.5278891208878891,
    "error_type": null,
    "error_message": null,
    "metrics": {
      "sharpe_ratio": 0.5278891208878891,
      "total_return": 0.7392776931435865,
      "max_drawdown": -0.27718127786208313
    }
  },
  "timestamp": "2025-11-21T12:58:45.745465"
}